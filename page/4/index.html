<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>RoxasDengBlog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="RoxasDengBlog">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="RoxasDengBlog">
<meta property="og:locale" content="zh_CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RoxasDengBlog">
  
    <link rel="alternate" href="/atom.xml" title="RoxasDengBlog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">RoxasDengBlog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-自动化测试&amp;发布npm包" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/09/自动化测试&发布npm包/" class="article-date">
  <time datetime="2019-04-09T07:49:19.000Z" itemprop="datePublished">2019-04-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/库/">库</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/09/自动化测试&发布npm包/">自动化测试&amp;发布npm包</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="1-自动化测试"><a href="#1-自动化测试" class="headerlink" title="1. 自动化测试"></a>1. 自动化测试</h4><ol>
<li>kama一个测试运行器,可呼起浏览器,加载测试脚本,运星测试用例.</li>
<li>mocha是一个单元测试框架/库,可以用来写测试用例.</li>
<li>sinon是一个spy/stub/mock库,用以辅助测试.</li>
</ol>
<p>运行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm i -D karma karma-chrome-launcher karma-mocha karma-sinon-chai mocha sinon sinon-chai karma-chai karma-chai-spies<br></code></pre></td></tr></table></figure></p>
<p>创建karma配置,karma.conf.js</p>
<p>输出目录:*代表加载所有文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">files: [<br>    <span class="hljs-string">'dist/**/*.test.js'</span>,<br>    <span class="hljs-string">'dist/**/*.test.css'</span><br>]<br></code></pre></td></tr></table></figure></p>
<p>运行浏览器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">browsers: [<span class="hljs-string">'ChromeHeadless'</span>],<br></code></pre></td></tr></table></figure>
<p>代码:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs bash">module.exports = <span class="hljs-keyword">function</span> (config) &#123;<br>     config.set(&#123;<br><br>         // base path that will be used to resolve all patterns (eg. files, exclude)<br>         basePath: <span class="hljs-string">''</span>,<br><br>        // frameworks to use<br>        // available frameworks: https://npmjs.org/browse/keyword/karma-adapter<br>        frameworks: [<span class="hljs-string">'mocha'</span>, <span class="hljs-string">'sinon-chai'</span>],<br>        client: &#123;<br>            chai: &#123;<br>                includeStack: <span class="hljs-literal">true</span><br>            &#125;<br>        &#125;,<br><br><br>        // list of files / patterns to load <span class="hljs-keyword">in</span> the browser<br>        files: [<br>            <span class="hljs-string">'dist/**/*.test.js'</span>,<br>            <span class="hljs-string">'dist/**/*.test.css'</span><br>        ],<br><br><br>        // list of files / patterns to exclude<br>        exclude: [],<br><br><br>        // preprocess matching files before serving them to the browser<br>        // available preprocessors: https://npmjs.org/browse/keyword/karma-preprocessor<br>        preprocessors: &#123;&#125;,<br><br><br>        // <span class="hljs-built_in">test</span> results reporter to use<br>        // possible values: <span class="hljs-string">'dots'</span>, <span class="hljs-string">'progress'</span><br>        // available reporters: https://npmjs.org/browse/keyword/karma-reporter<br>        reporters: [<span class="hljs-string">'progress'</span>],<br><br><br>        // web server port<br>        port: 9876,<br><br><br>        // <span class="hljs-built_in">enable</span> / <span class="hljs-built_in">disable</span> colors <span class="hljs-keyword">in</span> the output (reporters and logs)<br>        colors: <span class="hljs-literal">true</span>,<br><br><br>        // level of logging<br>        // possible values: config.LOG_DISABLE || config.LOG_ERROR || config.LOG_WARN || config.LOG_INFO || config.LOG_DEBUG<br>        logLevel: config.LOG_INFO,<br><br><br>        // <span class="hljs-built_in">enable</span> / <span class="hljs-built_in">disable</span> watching file and executing tests whenever any file changes<br>        autoWatch: <span class="hljs-literal">true</span>,<br><br><br>        // start these browsers<br>        // available browser launchers: https://npmjs.org/browse/keyword/karma-launcher<br>        browsers: [<span class="hljs-string">'ChromeHeadless'</span>],<br><br><br>        // Continuous Integration mode<br>        // <span class="hljs-keyword">if</span> <span class="hljs-literal">true</span>, Karma captures browsers, runs the tests and exits<br>        singleRun: <span class="hljs-literal">false</span>,<br><br>        // Concurrency level<br>        // how many browser should be started simultaneous<br>        concurrency: Infinity<br>    &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>
<p>创建test/button.test.js文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">const expect = chai.expect;<br> import Vue from <span class="hljs-string">'vue'</span><br> import Button from <span class="hljs-string">'../src/button'</span><br><br> Vue.config.productionTip = <span class="hljs-literal">false</span><br> Vue.config.devtools = <span class="hljs-literal">false</span><br><br>describe(<span class="hljs-string">'Button'</span>,()=&gt;&#123;<br>    it(<span class="hljs-string">'xxx'</span>,()=&gt;&#123;<br>        //测试代码<br>    &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure>
<p>创建测试脚本</p>
<p>在 package.json 里面找到 scripts 并改写 scripts<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-string">"scripts"</span>: &#123;<br>     <span class="hljs-string">"dev-test"</span>: <span class="hljs-string">"parcel watch test/* --no-cache &amp; karma start"</span>,<br>     <span class="hljs-string">"test"</span>: <span class="hljs-string">"parcel build test/* --no-minify &amp;&amp; karma start --single-run"</span><br> &#125;,<br></code></pre></td></tr></table></figure></p>
<p>运行测试脚本</p>
<ol>
<li>npm run test 一次性运行</li>
<li>npm run dev-test 进行watch运行</li>
</ol>
<h4 id="2-使用Mocha-amp-Chai做单元测试"><a href="#2-使用Mocha-amp-Chai做单元测试" class="headerlink" title="2.使用Mocha&amp;Chai做单元测试"></a>2.使用Mocha&amp;Chai做单元测试</h4><p>BDD  行为驱动测试</p>
<p>descrube 描述<br>expect 期待<br>eq 输出<br>deep 深相等<br>not 不<br>with 并且</p>
<p>descrube ‘people’</p>
<p>it has a head<br>it can run</p>
<p>expect(‘xxx’).eq(‘yyy’)</p>
<p>文档: <a href="http://www.chaijs.com" target="_blank" rel="noopener">www.chaijs.com</a></p>
<h4 id="3-使用TravisCI做持续集成"><a href="#3-使用TravisCI做持续集成" class="headerlink" title="3. 使用TravisCI做持续集成"></a>3. 使用TravisCI做持续集成</h4><p>注册travis账户.</p>
<p>根目录下创建 .travis.yml 文件</p>
<p>每次提交后可在travis上查看测试结果.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">language: node_js<br>node_js:<br>  - <span class="hljs-string">"8"</span><br>addons:<br>  chrome: stable<br>sudo: required<br>before_script:<br>  - <span class="hljs-string">"sudo chown root /opt/google/chrome/chrome-sandbox"</span><br>  - <span class="hljs-string">"sudo chmod 4755 /opt/google/chrome/chrome-sandbox"</span><br></code></pre></td></tr></table></figure>
<h4 id="为什么一个空数组不等于空数组"><a href="#为什么一个空数组不等于空数组" class="headerlink" title="为什么一个空数组不等于空数组"></a>为什么一个空数组不等于空数组</h4><p>因为引用不同,是两个数组</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[] == [] //<span class="hljs-literal">false</span><br><br>var a = []<br>a == [] //<span class="hljs-literal">false</span><br>a == [] //<span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure>
<h4 id="4-发布npm包"><a href="#4-发布npm包" class="headerlink" title="4. 发布npm包"></a>4. 发布npm包</h4><p>根目录下创建index.js<br>导入组件 导出组件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">improt cp from <span class="hljs-string">'./src/cp'</span><br>exprot &#123;cp&#125;<br></code></pre></td></tr></table></figure></p>
<p>查看自己当前npm源路径<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm config list<br></code></pre></td></tr></table></figure></p>
<p>要改成默认源才能发布npm包<br>每次发布需要更改package.json里的版本<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">//添加用户<br>npm adduser<br><br>//公开代码<br>npm publish<br></code></pre></td></tr></table></figure></p>
<p>由于引擎不能识别improt 所以要babel转移或者直接给他转义好</p>
<p>转义</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">//packjson输出目录修改成dist/index.js<br><br>运行<br><br>npx parcel build index.js --no-cache --no-minify<br></code></pre></td></tr></table></figure>
<h4 id="5-使用npm-link"><a href="#5-使用npm-link" class="headerlink" title="5. 使用npm link"></a>5. 使用npm link</h4><p>由于每次更新都需要更改package.json里的版本,然后npm publish,所以我们可以用本地调试,在项目目录使用npm link,在所用目录运行npm link xxx.</p>
<h4 id="6-书写README"><a href="#6-书写README" class="headerlink" title="6. 书写README"></a>6. 书写README</h4><p>shields.io生成图标</p>
<h4 id="7-安装git-open"><a href="#7-安装git-open" class="headerlink" title="7. 安装git open"></a>7. 安装git open</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm i -g git-open<br></code></pre></td></tr></table></figure>
<h4 id="8-git会到之前版本"><a href="#8-git会到之前版本" class="headerlink" title="8. git会到之前版本"></a>8. git会到之前版本</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git reset --hard xxx<br></code></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/09/自动化测试&发布npm包/" data-id="clq63ee6r006r94fqpkoghbes" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/库/">库</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Vue的几个小坑&amp;子选择器&amp;测试相关" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/03/Vue的几个小坑&子选择器&测试相关/" class="article-date">
  <time datetime="2019-04-03T09:09:04.000Z" itemprop="datePublished">2019-04-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/笔记/">笔记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/03/Vue的几个小坑&子选择器&测试相关/">Vue的几个小坑&amp;子选择器&amp;测试相关</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="1-vue中html属性使用简写的问题"><a href="#1-vue中html属性使用简写的问题" class="headerlink" title="1. vue中html属性使用简写的问题"></a>1. vue中html属性使用简写的问题</h4><p>假如子组件props进行类型检测,那么子组件接收不到</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">//parent<br>&lt;g-button right&gt;BTN&lt;/button&gt;<br><br>//component-A<br>props:[<span class="hljs-string">'right'</span>]<br><span class="hljs-function"><span class="hljs-title">mount</span></span>()&#123;<br>    console.log(this.right) //undefined<br>&#125;<br></code></pre></td></tr></table></figure>
<p>当子组件props进行类型检测,子组件能接受到值.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">//parent<br>&lt;g-button right&gt;BTN&lt;/button&gt;<br><br>//component-B<br>props:&#123;<br>    right:&#123;<br>        <span class="hljs-built_in">type</span>: Boolean,<br>        default: <span class="hljs-literal">false</span>,<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-title">mount</span></span>()&#123;<br>    console.log(this.right) // <span class="hljs-literal">true</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="2-组件点击事件失效的问题"><a href="#2-组件点击事件失效的问题" class="headerlink" title="2. 组件点击事件失效的问题"></a>2. 组件点击事件失效的问题</h4><p>点击button元素,事件不生效.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">//parent<br>&lt;g-button @click=<span class="hljs-string">"loading = !loading"</span>&gt;BTN&lt;/button&gt;<br></code></pre></td></tr></table></figure>
<p>解决办法.</p>
<ol>
<li>父元素事件绑定中添加修饰符native.</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">//parent<br>&lt;g-button @click.native=<span class="hljs-string">"loading = !loading"</span>&gt;BTN&lt;/button&gt;<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>子组件中监听自身的click事件,调用函数给父组件发送click事件,父组件监听该click事件.</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">//parent<br>&lt;g-button @click=<span class="hljs-string">"loading = !loading"</span>&gt;BTN&lt;/button&gt;<br><br>//component<br>&lt;button @click=<span class="hljs-string">"_click"</span>&gt;<br>    &lt;slot&gt;&lt;/slot&gt;<br>&lt;/button&gt;<br><br>methods:&#123;<br>    <span class="hljs-function"><span class="hljs-title">_click</span></span>()&#123;<br>        this.<span class="hljs-variable">$emit</span>(<span class="hljs-string">'click'</span>)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="3-scss子选择器"><a href="#3-scss子选择器" class="headerlink" title="3. scss子选择器"></a>3. scss子选择器</h4><p>注意:子选择器写在子元素上,而不是父元素上</p>
<p>错误:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">//<span class="hljs-literal">false</span><br>&lt;ul&gt;<br>    &lt;li&gt;1&lt;/li&gt;<br>    &lt;li&gt;2&lt;/li&gt;<br>    &lt;li&gt;3&lt;/li&gt;<br>&lt;/ul&gt;<br><br>ul&#123;<br>    &amp;:first-child&#123;<br>        color:red<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p>
<p>正确:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">//<span class="hljs-literal">true</span><br>&lt;ul&gt;<br>    &lt;li&gt;1&lt;/li&gt;<br>    &lt;li&gt;2&lt;/li&gt;<br>    &lt;li&gt;3&lt;/li&gt;<br>&lt;/ul&gt;<br><br>ul&#123;<br>    li&#123;<br>        &amp;:first-child&#123;<br>            color:red<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p>
<ol start="4">
<li>几个有用子选择器</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs undefined">//第一个元素<br><br>li:first-child<br><br>//最后一个元素<br>li:last-child<br><br>//非第一个元素<br><br>li:not(:first-child)<br></code></pre></td></tr></table></figure>
<h4 id="4-测试相关"><a href="#4-测试相关" class="headerlink" title="4. 测试相关"></a>4. 测试相关</h4><ol>
<li>BDD 行为驱动开发 (用自然语言描述)</li>
<li>TDD 测试驱动开发 (通过测试)</li>
<li>Assert 断言 (主观认为,例如console.log)</li>
</ol>
<h5 id="库-chai-js"><a href="#库-chai-js" class="headerlink" title="库 chai.js"></a>库 chai.js</h5><p>Should 应该</p>
<p>Expect 期望</p>
<p>Assert 断言</p>
<p>安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm -D chai<br></code></pre></td></tr></table></figure></p>
<p>使用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">import chai from <span class="hljs-string">'chai'</span><br>const &#123; expect &#125; = chai<br><span class="hljs-built_in">let</span> <span class="hljs-built_in">test</span> = <span class="hljs-string">'abc'</span><br>expect(<span class="hljs-built_in">test</span>).to.eq(<span class="hljs-string">'abc'</span>)<br></code></pre></td></tr></table></figure>
<h5 id="mock"><a href="#mock" class="headerlink" title="mock"></a>mock</h5><p> chai-spies</p>
<p> 监听函数</p>
<p>使用:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">//引入<br>import chai from <span class="hljs-string">'chai'</span><br>import spies from <span class="hljs-string">'chai-spies'</span><br>chai.use(spies)<br>const &#123; expect &#125; = chai<br><br>//vue使用<br>const Constructor = Vue.extend(gButton);<br>const vm = new Constructor(&#123;<br>    propsData: &#123;<br>        icon: <span class="hljs-string">'setting'</span>,<br>    &#125;<br>&#125;)<br>vm.<span class="hljs-variable">$mount</span>();<br><span class="hljs-built_in">let</span> spy = chai.spy(<span class="hljs-function"><span class="hljs-title">function</span></span> () &#123; &#125;)<br>vm.<span class="hljs-variable">$on</span>(<span class="hljs-string">'click'</span>, spy)<br><span class="hljs-built_in">let</span> button = vm.<span class="hljs-variable">$el</span><br>button.click();<br>expect(spy).to.have.been.called()<br></code></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/03/Vue的几个小坑&子选择器&测试相关/" data-id="clq63ee4y003094fqgy7ihyka" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/笔记/">笔记</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-截图插件vue-cropper的使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/03/04/截图插件vue-cropper的使用/" class="article-date">
  <time datetime="2019-03-04T04:47:12.000Z" itemprop="datePublished">2019-03-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/库/">库</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/03/04/截图插件vue-cropper的使用/">截图插件vue-cropper的使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>vue-cropper是基于cropper.js封装的一个vue组件.功能强大.</p>
<p><a href="https://github.com/fengyuanchen/cropperjs#options" title="文档链接" target="_blank" rel="noopener">cropper.js链接</a></p>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p><a href="https://github.com/roxas332519096/vue-cropperjs" title="文档链接" target="_blank" rel="noopener">官方链接</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install --save vue-cropperjs<br><br>// Global<br>import Vue from <span class="hljs-string">'vue'</span>;<br>import VueCropper from <span class="hljs-string">'vue-cropperjs'</span>;<br>Vue.component(VueCropper);<br><br>// Local<br>import VueCropper from <span class="hljs-string">'vue-cropperjs'</span>;<br><span class="hljs-built_in">export</span> default &#123;<br>  components: &#123; VueCropper&#125;<br>&#125;<br><br>&lt;vue-cropper<br>  ref=<span class="hljs-string">"cropper"</span><br>  :src=<span class="hljs-string">"imgSrc"</span><br>  alt=<span class="hljs-string">"Source Image"</span><br>  :cropmove=<span class="hljs-string">"cropImage"</span><br>/&gt;<br></code></pre></td></tr></table></figure>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>vue-cropper通过绑定属性进行配置</p>
<p>例如:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;vue-cropper<br>    :viewMode=<span class="hljs-string">"2"</span><br>/&gt;<br></code></pre></td></tr></table></figure>
<h4 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;vue-cropper<br>    :viewMode=<span class="hljs-string">"2"</span><br>    drag-mode=<span class="hljs-string">"crop"</span><br>    :background=<span class="hljs-string">"true"</span><br>    ref=<span class="hljs-string">"cropper"</span><br>    :src=<span class="hljs-string">"imgSrc"</span><br>    key=<span class="hljs-string">"cropKey"</span> //由于cropper初始化时,option已决定截图框大小等,所以变换key使视图重新渲染<br>/&gt;<br><br>&lt;img :src=<span class="hljs-string">"cropImg"</span> /&gt;<br><br><span class="hljs-function"><span class="hljs-title">data</span></span>()&#123;<br>  <span class="hljs-built_in">return</span> &#123;<br>    imgSrc:<span class="hljs-string">'图片url'</span>,<br>    cropKey:0,<br>    cropImg:<span class="hljs-string">''</span>,<br>  &#125;<br>&#125;<br><br>const reader = new FileReader();<br>reader.onload = event =&gt; &#123;<br>  this.imgSrc = event.target.result;<br>  this.<span class="hljs-variable">$refs</span>.cropper.replace(event.target.result);<br>&#125;;<br>reader.readAsDataURL(this.file);<br></code></pre></td></tr></table></figure>
<h4 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h4><h5 id="vieMode显示模式"><a href="#vieMode显示模式" class="headerlink" title="vieMode显示模式"></a>vieMode显示模式</h5><p>Type:number<br>Default:0</p>
<p>0:裁剪框只能在图片内移动<br>1:裁剪框能在容器内移动<br>2:裁剪框只能在图片内移动,并且图片最大缩小不能超出裁剪框(图片不平铺满容器,存在间隙)<br>3:裁剪框只能在图片内移动,并且图片最大缩小不能超出裁剪框(图片平铺满容器,不存在间隙)</p>
<h5 id="dragMode-拖动模式"><a href="#dragMode-拖动模式" class="headerlink" title="dragMode 拖动模式"></a>dragMode 拖动模式</h5><p>Default:’crop’<br>‘crop’:当鼠标点击一处时根据这个点重新生成一个裁剪框,不可拖动图片<br>‘move’:可拖动图片<br>‘none’:不可拖动图片</p>
<h5 id="aspectRatio"><a href="#aspectRatio" class="headerlink" title="aspectRatio"></a>aspectRatio</h5><p>Type:numbe<br>Default:NAN<br>可设置n/n,比例为n:n</p>
<h5 id="preview"><a href="#preview" class="headerlink" title="preview"></a>preview</h5><p>Type:string,element<br>Default:’’<br>是一个选择器,必须被Document.querySelectorAll获取到</p>
<h5 id="responsive"><a href="#responsive" class="headerlink" title="responsive"></a>responsive</h5><p>Type:Boolean<br>Default:true<br>在调整窗口大小的时候重新渲染cropper</p>
<h5 id="modal"><a href="#modal" class="headerlink" title="modal"></a>modal</h5><p>Type:Boolean<br>Default:true<br>截图时图片上方的黑色遮罩层</p>
<h5 id="guides"><a href="#guides" class="headerlink" title="guides"></a>guides</h5><p>Type:Boolean<br>Default:true<br>截图框虚线</p>
<h5 id="center"><a href="#center" class="headerlink" title="center"></a>center</h5><p>Type:Boolean<br>Default:true<br>截图框在图片中烟</p>
<h5 id="highlight"><a href="#highlight" class="headerlink" title="highlight"></a>highlight</h5><p>Type:Boolean<br>Default:true<br>突出截图框</p>
<h5 id="background"><a href="#background" class="headerlink" title="background"></a>background</h5><p>Type:Boolean<br>Default:true<br>显示网格背景</p>
<h5 id="autoCrop"><a href="#autoCrop" class="headerlink" title="autoCrop"></a>autoCrop</h5><p>Type:Boolean<br>Default:true<br>自动显示截图框</p>
<h5 id="autoCropArea"><a href="#autoCropArea" class="headerlink" title="autoCropArea"></a>autoCropArea</h5><p>Type:number<br>Default:0.8<br>截图框与图片的比例</p>
<h5 id="movable"><a href="#movable" class="headerlink" title="movable"></a>movable</h5><p>Type:Boolean<br>Default:true<br>是否可允许移动图片</p>
<h5 id="rotatable"><a href="#rotatable" class="headerlink" title="rotatable"></a>rotatable</h5><p>Type:Boolean<br>Default:true<br>是否可旋转图片</p>
<h5 id="scalable"><a href="#scalable" class="headerlink" title="scalable"></a>scalable</h5><p>Type:Boolean<br>Default:true<br>是否可缩放图片</p>
<h5 id="zoomable"><a href="#zoomable" class="headerlink" title="zoomable"></a>zoomable</h5><p>Type:Boolean<br>Default:true<br>是否可放大图片</p>
<h5 id="zoomOnTouch"><a href="#zoomOnTouch" class="headerlink" title="zoomOnTouch"></a>zoomOnTouch</h5><p>Type:Boolean<br>Default:true<br>是否可通过触摸放大图片</p>
<h5 id="zoomOnWheel"><a href="#zoomOnWheel" class="headerlink" title="zoomOnWheel"></a>zoomOnWheel</h5><p>Type:Boolean<br>Default:true<br>是否可通过光标放大图片</p>
<h5 id="wheelZoomRatio"><a href="#wheelZoomRatio" class="headerlink" title="wheelZoomRatio"></a>wheelZoomRatio</h5><p>Type:number<br>Default:0.1<br>用鼠标移动图像时，定义缩放比例</p>
<h5 id="cropBoxMovable"><a href="#cropBoxMovable" class="headerlink" title="cropBoxMovable"></a>cropBoxMovable</h5><p>Type:Boolean<br>Default:true<br>截图框是否可拖动</p>
<h5 id="toggleDragModeOnDblclick"><a href="#toggleDragModeOnDblclick" class="headerlink" title="toggleDragModeOnDblclick"></a>toggleDragModeOnDblclick</h5><p>Type:Boolean<br>Default:true<br>点击两次可切换拖动模式与移动图片模式</p>
<h5 id="minContainerWidth"><a href="#minContainerWidth" class="headerlink" title="minContainerWidth"></a>minContainerWidth</h5><p>Type:number<br>Default:200<br>容器最小宽度</p>
<h5 id="minContainerHeight"><a href="#minContainerHeight" class="headerlink" title="minContainerHeight"></a>minContainerHeight</h5><p>Type:number<br>Default:100<br>容器最小高度</p>
<h5 id="minCanvasWidth"><a href="#minCanvasWidth" class="headerlink" title="minCanvasWidth"></a>minCanvasWidth</h5><p>Type:number<br>Default:0<br>canvas最小高度</p>
<h5 id="minCanvasHeight"><a href="#minCanvasHeight" class="headerlink" title="minCanvasHeight"></a>minCanvasHeight</h5><p>Type:number<br>Default:0<br>canvas最小高度</p>
<h5 id="minCropBoxWidth"><a href="#minCropBoxWidth" class="headerlink" title="minCropBoxWidth"></a>minCropBoxWidth</h5><p>Type:number<br>Default:0<br>截图框最小宽度</p>
<h5 id="minCropBoxHeight"><a href="#minCropBoxHeight" class="headerlink" title="minCropBoxHeight"></a>minCropBoxHeight</h5><p>Type:number<br>Default:0<br>截图框最小高度</p>
<h5 id="ready"><a href="#ready" class="headerlink" title="ready"></a>ready</h5><p>Type:function<br>Default:null<br>插件准备时执行的函数</p>
<h5 id="cropstart"><a href="#cropstart" class="headerlink" title="cropstart"></a>cropstart</h5><p>Type:function<br>Default:null<br>截图框开始移动执行的函数</p>
<h5 id="cropmove"><a href="#cropmove" class="headerlink" title="cropmove"></a>cropmove</h5><p>Type:function<br>Default:null<br>截图框移动执行的函数</p>
<h5 id="cropend"><a href="#cropend" class="headerlink" title="cropend"></a>cropend</h5><p>Type:function<br>Default:null<br>截图框移动结束的函数</p>
<h5 id="crop"><a href="#crop" class="headerlink" title="crop"></a>crop</h5><p>Type:function<br>Default:null<br>截图框发生变化执行的函数</p>
<h5 id="zoom"><a href="#zoom" class="headerlink" title="zoom"></a>zoom</h5><p>Type:function<br>Default:null<br>截图框缩放时执行的函数</p>
<h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">this.cropImg = this.<span class="hljs-variable">$refs</span>.cropper.getCroppedCanvas().toDataURL();<br></code></pre></td></tr></table></figure>
<h5 id="crop-手动显示裁剪框"><a href="#crop-手动显示裁剪框" class="headerlink" title="crop() 手动显示裁剪框"></a>crop() 手动显示裁剪框</h5><h5 id="reset-将图像和裁剪框重置为初始状态"><a href="#reset-将图像和裁剪框重置为初始状态" class="headerlink" title="reset() 将图像和裁剪框重置为初始状态"></a>reset() 将图像和裁剪框重置为初始状态</h5><h5 id="clear-清除截图框"><a href="#clear-清除截图框" class="headerlink" title="clear() 清除截图框"></a>clear() 清除截图框</h5><h5 id="replace-url-onlyColorChanged-替换图像的src并重新构建cropper"><a href="#replace-url-onlyColorChanged-替换图像的src并重新构建cropper" class="headerlink" title="replace(url[, onlyColorChanged]) 替换图像的src并重新构建cropper"></a>replace(url[, onlyColorChanged]) 替换图像的src并重新构建cropper</h5><p>url Type:string<br>onlyColorChanged Type:Boolean;Default:false<br>如果只是改变颜色，而不是大小，那么cropper只需要改变所有相关图像的src，不需要重新构建cropper。这可以用于应用过滤器。（意思是：改成true，图像的比例会发生变化自适应父盒子的大小；会失真的）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">this.<span class="hljs-variable">$refs</span>.cropper.replace(<span class="hljs-string">'/img.jpg'</span>,<span class="hljs-literal">true</span>)<br></code></pre></td></tr></table></figure>
<h5 id="enable-解锁锁定的截图框"><a href="#enable-解锁锁定的截图框" class="headerlink" title="enable() 解锁锁定的截图框"></a>enable() 解锁锁定的截图框</h5><h5 id="disable-锁定截图框"><a href="#disable-锁定截图框" class="headerlink" title="disable() 锁定截图框"></a>disable() 锁定截图框</h5><h5 id="destroy-销毁cropper并从图像中删除整个cropper"><a href="#destroy-销毁cropper并从图像中删除整个cropper" class="headerlink" title="destroy() 销毁cropper并从图像中删除整个cropper"></a>destroy() 销毁cropper并从图像中删除整个cropper</h5><h5 id="move-offsetX-offsetY-使用相对偏移量移动图像-截图框不移动"><a href="#move-offsetX-offsetY-使用相对偏移量移动图像-截图框不移动" class="headerlink" title="move(offsetX[,offsetY]) 使用相对偏移量移动图像(截图框不移动)"></a>move(offsetX[,offsetY]) 使用相对偏移量移动图像(截图框不移动)</h5><h5 id="moveTo-x-y-将容器移动到一个绝对点"><a href="#moveTo-x-y-将容器移动到一个绝对点" class="headerlink" title="moveTo(x[,y]) 将容器移动到一个绝对点"></a>moveTo(x[,y]) 将容器移动到一个绝对点</h5><h5 id="zoom-ratio-放大图片-并使用相对比例-截图框不变化"><a href="#zoom-ratio-放大图片-并使用相对比例-截图框不变化" class="headerlink" title="zoom(ratio) 放大图片,并使用相对比例 (截图框不变化)"></a>zoom(ratio) 放大图片,并使用相对比例 (截图框不变化)</h5><p>ratio type:number </p>
<h5 id="rotate-degree-旋转图像以一定的角度"><a href="#rotate-degree-旋转图像以一定的角度" class="headerlink" title="rotate(degree) 旋转图像以一定的角度"></a>rotate(degree) 旋转图像以一定的角度</h5><p>degree type:number</p>
<h5 id="rotateTo-degree-旋转图像到固定的角度"><a href="#rotateTo-degree-旋转图像到固定的角度" class="headerlink" title="rotateTo(degree) 旋转图像到固定的角度"></a>rotateTo(degree) 旋转图像到固定的角度</h5><p>degree type:number</p>
<h5 id="scale-scaleX-scaleY-翻转图像"><a href="#scale-scaleX-scaleY-翻转图像" class="headerlink" title="scale(scaleX[, scaleY]) 翻转图像"></a>scale(scaleX[, scaleY]) 翻转图像</h5><p>scaleX type:number 水平方向翻转 default:1<br>scaleY type:number 垂直方向翻转 假如不存在则与x相同</p>
<h5 id="scaleX-scaleX-缩放图像的横坐标"><a href="#scaleX-scaleX-缩放图像的横坐标" class="headerlink" title="scaleX(scaleX) 缩放图像的横坐标"></a>scaleX(scaleX) 缩放图像的横坐标</h5><h5 id="scaleY-scaleY-缩放图像的纵坐标"><a href="#scaleY-scaleY-缩放图像的纵坐标" class="headerlink" title="scaleY(scaleY) 缩放图像的纵坐标"></a>scaleY(scaleY) 缩放图像的纵坐标</h5><h5 id="getData-rounded-输出最终裁剪的区域位置和大小数据-根据原始图像的自然大小"><a href="#getData-rounded-输出最终裁剪的区域位置和大小数据-根据原始图像的自然大小" class="headerlink" title="getData([rounded]) 输出最终裁剪的区域位置和大小数据(根据原始图像的自然大小)"></a>getData([rounded]) 输出最终裁剪的区域位置和大小数据(根据原始图像的自然大小)</h5><p>rounded<br>Type:Boolean<br>Default:false 设置true可获得数据<br>返回数据<br>Type:Object</p>
<ul>
<li>x 截图框距离左边的距离</li>
<li>y 截图框距离顶部的距离</li>
<li>width 截图框的宽度</li>
<li>height 截图框的高度</li>
<li>rotate 截图框的旋转的角度</li>
<li>scaleX 缩放图像的横坐标</li>
<li>scaleY 缩放图像的纵坐标 </li>
</ul>
<h5 id="setData-data-用新数据改变裁切区域的位置和大小-以原始图像为基础"><a href="#setData-data-用新数据改变裁切区域的位置和大小-以原始图像为基础" class="headerlink" title="setData(data) 用新数据改变裁切区域的位置和大小(以原始图像为基础)"></a>setData(data) 用新数据改变裁切区域的位置和大小(以原始图像为基础)</h5><p>data<br>Type:Object</p>
<h5 id="getContainerData-输出container-容器大小数据"><a href="#getContainerData-输出container-容器大小数据" class="headerlink" title="getContainerData() 输出container 容器大小数据"></a>getContainerData() 输出container 容器大小数据</h5><p>返回数据<br>Type:Object</p>
<ul>
<li>Width 当前容器宽度</li>
<li>Height 当前容器高度</li>
</ul>
<h5 id="getImageData-输出图像image位置-大小和其他相关数据"><a href="#getImageData-输出图像image位置-大小和其他相关数据" class="headerlink" title="getImageData() 输出图像image位置,大小和其他相关数据"></a>getImageData() 输出图像image位置,大小和其他相关数据</h5><p>返回数据<br>Type:Object</p>
<ul>
<li>left image距离左边的距离</li>
<li>top image距离顶部的距离</li>
<li>width image的宽度</li>
<li>height image的高度</li>
<li>naturalWidth image的原始宽度</li>
<li>naturalHeight image的原始高度</li>
<li>aspectRatio image的纵横比</li>
<li>rotate image的旋转的角度</li>
<li>scaleX 缩放图像的横坐标</li>
<li>scaleY 缩放图像的纵坐标</li>
</ul>
<h5 id="getCanvasData-输出画布Canvas-图像包装器-位置和大小数据"><a href="#getCanvasData-输出画布Canvas-图像包装器-位置和大小数据" class="headerlink" title="getCanvasData() 输出画布Canvas(图像包装器)位置和大小数据"></a>getCanvasData() 输出画布Canvas(图像包装器)位置和大小数据</h5><p>返回数据<br>Type:Object</p>
<ul>
<li>left canvas距离左边的距离</li>
<li>top canvas距离顶部的距离</li>
<li>width canvas的宽度</li>
<li>height canvas的高度</li>
<li>naturalWidth canvas的原始宽度</li>
<li>naturalHeight canvas的原始高度</li>
</ul>
<h5 id="setCanvasData-data-使用数据更改画布Canvas-图像包装器-位置和大小"><a href="#setCanvasData-data-使用数据更改画布Canvas-图像包装器-位置和大小" class="headerlink" title="setCanvasData(data) 使用数据更改画布Canvas(图像包装器)位置和大小"></a>setCanvasData(data) 使用数据更改画布Canvas(图像包装器)位置和大小</h5><p>返回数据<br>Type:Object</p>
<ul>
<li>left canvas距离左边的距离</li>
<li>top canvas距离顶部的距离</li>
<li>width canvas的宽度</li>
<li>height canvas的高度</li>
</ul>
<h5 id="getCropBoxData-输出截图框的位置和大小数据"><a href="#getCropBoxData-输出截图框的位置和大小数据" class="headerlink" title="getCropBoxData() 输出截图框的位置和大小数据"></a>getCropBoxData() 输出截图框的位置和大小数据</h5><p>返回数据<br>Type:Object</p>
<ul>
<li>left 截图框距离左边的距离</li>
<li>top 截图框距离顶部的距离</li>
<li>width 截图框的宽度</li>
<li>height 截图框的高度</li>
</ul>
<h5 id="setCropBoxData-data-改变截图框的位置和大小数据"><a href="#setCropBoxData-data-改变截图框的位置和大小数据" class="headerlink" title="setCropBoxData(data) 改变截图框的位置和大小数据"></a>setCropBoxData(data) 改变截图框的位置和大小数据</h5><p>返回数据<br>Type:Object</p>
<ul>
<li>left 截图框距离左边的距离</li>
<li>top 截图框距离顶部的距离</li>
<li>width 截图框的宽度</li>
<li>height 截图框的高度</li>
</ul>
<h5 id="getCroppedCanvas-options-—画一张剪裁的图片-如果没有剪裁，则返回一个绘制整个im的画布"><a href="#getCroppedCanvas-options-—画一张剪裁的图片-如果没有剪裁，则返回一个绘制整个im的画布" class="headerlink" title="getCroppedCanvas([options])—画一张剪裁的图片,如果没有剪裁，则返回一个绘制整个im的画布"></a>getCroppedCanvas([options])—画一张剪裁的图片,如果没有剪裁，则返回一个绘制整个im的画布</h5><p>options<br>Type:Object<br>options 类型Object</p>
<ul>
<li>width 输出Canvas的宽度</li>
<li>height 输出Canvas的高度</li>
<li>minWidth 输出Canvas的最小宽度；默认值是0</li>
<li>minHeight 输出Canvas的最小高度；默认值是0</li>
<li>maxWidth 输出Canvas的最大宽度；默认值是Infinity（无穷大）</li>
<li>maxHeight 输出Canvas的最大高度；默认值是Infinity（无穷大）</li>
<li>fillColor 在输出画布Canvas中填充任何alpha的颜色，默认值是透明的</li>
<li>imageSmoothingEnabled 如果图像被设置为平滑(true，默认)或不设置(false)。</li>
<li>imageSmoothingQuality 设置图像的质量，一个“low”(默认)、“medium”或“high”</li>
</ul>
<p>返回数据：<br>Type：HTMLCanvasElement画布绘制出了剪裁过的图像<br>注意：输出canvas画布的宽高比将自动适应剪切框的纵横比.<br>如果你打算从输出画布canvas中获得一个JPEG图像，您应该首先设置填色选项,否则,JPEG图像中的透明部分将在缺少情况下变为黑色.<br>为了避免获得空白的输出图像,您可能需要将maxWidth和maxHeightproperties设置为有限的数字,从而来画布元素的大小限制.</p>
<h5 id="setAspectRatio-aspectRatio-改变裁切框的宽高比"><a href="#setAspectRatio-aspectRatio-改变裁切框的宽高比" class="headerlink" title="setAspectRatio(aspectRatio) 改变裁切框的宽高比"></a>setAspectRatio(aspectRatio) 改变裁切框的宽高比</h5><p>aspectRatio:<br>Type:number 是一个正数</p>
<h5 id="setDragMode-mode-设置拖拽模式-鼠标显示的是十字还是那种带箭头的十字"><a href="#setDragMode-mode-设置拖拽模式-鼠标显示的是十字还是那种带箭头的十字" class="headerlink" title="setDragMode([mode]) 设置拖拽模式,鼠标显示的是十字还是那种带箭头的十字"></a>setDragMode([mode]) 设置拖拽模式,鼠标显示的是十字还是那种带箭头的十字</h5><p>mode:<br>Type:string (none,crop,move)<br>Default:null</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/03/04/截图插件vue-cropper的使用/" data-id="clq63ee6a005o94fq9gjtaioy" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/库/">库</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-深入了解函数" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/20/深入了解函数/" class="article-date">
  <time datetime="2019-02-20T12:50:53.000Z" itemprop="datePublished">2019-02-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JS/">JS</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/02/20/深入了解函数/">深入了解函数</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="函数声明"><a href="#函数声明" class="headerlink" title="函数声明"></a>函数声明</h4><h5 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">var fn = <span class="hljs-function"><span class="hljs-title">function</span></span>()&#123;<br>    <span class="hljs-built_in">return</span> 1<br>&#125;<br><br>var fn2 = fn<br>fn.name //fn<br>fn2.name //fn<br></code></pre></td></tr></table></figure>
<p>注意,这里的变量fn是保存匿名函数的内存地址,而不是函数本身.</p>
<h5 id="具名函数"><a href="#具名函数" class="headerlink" title="具名函数"></a>具名函数</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">fn3</span></span>()&#123;<br>    <span class="hljs-built_in">return</span> 3<br>&#125;<br><br>var fn5 = <span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">fn4</span></span>()&#123;<br>    <span class="hljs-built_in">return</span> 4<br>&#125;<br><br>console.log(fn3) //3<br>console.log(fn4) //undefined<br>console.log(fn5) //4<br></code></pre></td></tr></table></figure>
<p>注意,具名函数假如不赋值给变量,那么作用域是全局,如果赋值给变量,那么作用域在函数本身.</p>
<h5 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">var fn6 = i =&gt; i+1<br><br>fn6(1) //2<br><br>var fn7 = i =&gt;&#123;<br>    i+1;<br>    ...doSometing<br>&#125;<br><br>fn7(1) //undefiend<br></code></pre></td></tr></table></figure>
<p>假如箭头函数只有一个变量,那么括号可不写.<br>箭头函数的函数体只有一句话,那么return的值就是求的值.<br>箭头函数的this是上下文的this.</p>
<h4 id="词法作用域-静态作用域"><a href="#词法作用域-静态作用域" class="headerlink" title="词法作用域(静态作用域)"></a>词法作用域(静态作用域)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">var globall1 = 1<br><span class="hljs-keyword">function</span> fn1(param1)&#123;<br>    var local1 = <span class="hljs-string">'local1'</span><br>    var local2 = <span class="hljs-string">'local2'</span><br>    <span class="hljs-keyword">function</span> fn2(param2)&#123;<br>        var local2 = <span class="hljs-string">'inner local2'</span><br>        console.log(local1)<br>        console.log(local2)<br>    &#125;<br>    <span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">fn3</span></span>()&#123;<br>        var local2 = <span class="hljs-string">'fn3 local2'</span><br>        fn2(local2)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>JS引擎会先进行词法解析,并形成词法树</p>
<p>下面是上面函数的词法树</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>   window<br>     |<br> ----------<br>|         |<br>global1  fn1<br>---<br> |<br>------------------------------------<br> |       |          |       |       |<br> param1 local1    local2   fn2     fn3<br>                            |       |<br>                           ---     ---<br>                            |       |<br>                          local2  local2<br></code></pre></td></tr></table></figure>
<ol>
<li>当函数寻找变量的时候,会先从函数内部寻找变量</li>
<li><p>假如没有该变量,则会从词法树往上找.</p>
</li>
<li><p>fn2里的console.log(local1)是上层fn1的local2,所以输出’local1’,</p>
</li>
<li>fn2里的console.log(local2)是自己的local2,所以输出’inner local2’,</li>
<li>fn3里的local2是自己的local2,为’fn3 local2’.</li>
<li>fn3里的fn2(local2),local2是他本身local2,即fn2(‘fn3 local2’),最终结果同2.</li>
</ol>
<h4 id="Call-stack"><a href="#Call-stack" class="headerlink" title="Call stack"></a>Call stack</h4><p>Stack(栈),先进后出.</p>
<ol>
<li><p>普通调用</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">a</span></span>()&#123;<br>    console.log(<span class="hljs-string">'a'</span>)<br>    <span class="hljs-built_in">return</span> <span class="hljs-string">'a'</span><br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">a</span></span>()&#123;<br>    console.log(<span class="hljs-string">'b'</span>)<br>    <span class="hljs-built_in">return</span> <span class="hljs-string">'b'</span><br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">a</span></span>()&#123;<br>    console.log(<span class="hljs-string">'c'</span>)<br>    <span class="hljs-built_in">return</span> <span class="hljs-string">'c'</span><br>&#125;<br><br>a()<br>b()<br>c()<br></code></pre></td></tr></table></figure>
<p> 运行函数</p>
<p> 进行了以下事情</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">先进行词法解析,函数提升<br><br>-&gt;a() //进入a,记下a的位置<br>    -&gt;console.log(<span class="hljs-string">'a'</span>) //进入,记下该位置<br>    &lt;-console.log(<span class="hljs-string">'a'</span>) //退出,回到原位置<br>    -&gt;<span class="hljs-built_in">return</span> <span class="hljs-string">'a'</span> //进入<br>    &lt;-<span class="hljs-built_in">return</span> <span class="hljs-string">'a'</span> //退出<br>&lt;-a() //退出a,回到原来a的位置<br><br>-&gt;b()//进入b,记下a的位置<br><br>    ...<br><br>&lt;-c() `<br></code></pre></td></tr></table></figure>
</li>
<li><p>嵌套调用</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">a</span></span>()&#123;<br>    console.log(<span class="hljs-string">'a1'</span>)<br>    b()<br>    console.log(<span class="hljs-string">'a2'</span>)<br>    <span class="hljs-built_in">return</span> <span class="hljs-string">'a'</span><br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">a</span></span>()&#123;<br>    console.log(<span class="hljs-string">'b1'</span>)<br>    c()<br>    console.log(<span class="hljs-string">'b2'</span>)<br>    <span class="hljs-built_in">return</span> <span class="hljs-string">'b'</span><br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">a</span></span>()&#123;<br>    console.log(<span class="hljs-string">'c'</span>)<br>    <span class="hljs-built_in">return</span> <span class="hljs-string">'c'</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">-&gt;a()<br>    -&gt;console.log(<span class="hljs-string">'a1'</span>)<br>    &lt;-console.log(<span class="hljs-string">'a1'</span>)<br>    -&gt;b()<br>        -&gt;console.log(<span class="hljs-string">'b1'</span>)<br>        &lt;-console.log(<span class="hljs-string">'b1'</span>)<br>        -&gt;c()<br>            -&gt;console.log(<span class="hljs-string">'c'</span>)<br>            &lt;-console.log(<span class="hljs-string">'c'</span>)<br>            -&gt;<span class="hljs-built_in">return</span> <span class="hljs-string">'c'</span><br>            &lt;-<span class="hljs-built_in">return</span> <span class="hljs-string">'c'</span><br>        &lt;-c()<br>        -&gt;console.log(<span class="hljs-string">'b2'</span>)<br>        &lt;-console.log(<span class="hljs-string">'b2'</span>)<br>        -&gt;<span class="hljs-built_in">return</span> <span class="hljs-string">'b'</span><br>        &lt;-<span class="hljs-built_in">return</span> <span class="hljs-string">'b'</span><br>    &lt;-b()<br>    -&gt;console.log(<span class="hljs-string">'a2'</span>)<br>    &lt;-console.log(<span class="hljs-string">'a2'</span>)<br>    -&gt;<span class="hljs-built_in">return</span> <span class="hljs-string">'a'</span><br>    &lt;-<span class="hljs-built_in">return</span> <span class="hljs-string">'a'</span><br>&lt;-a()<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>递归</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> fab(n)&#123;<br>    console.log(<span class="hljs-string">'strat calc fab'</span> +n)<br>    <span class="hljs-keyword">if</span>(n&gt;=3)&#123;<br>        <span class="hljs-built_in">return</span> fab(n-1) + fab(n-2)<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-built_in">return</span> 1<br>    &#125;<br>&#125;<br><br>fab(5)<br></code></pre></td></tr></table></figure>
<p>运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">strat calc fab 5<br>    5&gt;3<br>    求fab(4)<br>        strat calc fab 4<br>        fab(3)+fab(2)<br>        4&gt;3<br>        求fab(3)<br>            strat calc fab 3<br>            fab(2)+fab(1)<br>            3=3<br>            求fab(2)<br>                strat calc fab 2<br>                fab(2)+fab(1)<br>                3-1&lt;3<br>                fab(2)=1<br>            求fab(1)<br>                strat calc fab 1<br>                1&lt;3<br>                fab(1)=1<br>        得fab(3) = 1 + 1 = 2<br>        求fab(2)<br>            strat calc fab 2<br>            2&lt;3<br>            fab(2)=1<br>        得fab(2) = 1<br>    得fab(4) = 2 + 1 = 3<br>    求fab(3)<br>        strat calc fab3<br>        fab(2)+fb(1)<br>            求fab(2)<br>            strat calc fab 2<br>            2&lt;3<br>            fab(2)=1<br>            求fab(1)<br>             strat calc fab1<br>             fab(1)=1<br>    得fab(3) = 1 + 1 = 2<br>得fab(5) = 3 + 2 = 5<br></code></pre></td></tr></table></figure>
<h4 id="this-amp-arguments"><a href="#this-amp-arguments" class="headerlink" title="this&amp;arguments"></a>this&amp;arguments</h4><h5 id="this是隐藏的第一参数-且必须是对象"><a href="#this是隐藏的第一参数-且必须是对象" class="headerlink" title="this是隐藏的第一参数,且必须是对象"></a>this是隐藏的第一参数,且必须是对象</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">f</span></span>()&#123;<br>    console.log(this)<br>    console.log(arguments)<br>&#125;<br><br>f.call() //window (chrome是Window) ,[]<br>f.call(&#123;name:<span class="hljs-string">'a'</span>&#125;) //&#123;name:<span class="hljs-string">'a'</span>&#125; ,[]<br>f.call(&#123;name:<span class="hljs-string">'a'</span>&#125;,1) //&#123;name:<span class="hljs-string">'a'</span>&#125;,[1]<br>f.call(&#123;name:<span class="hljs-string">'a'</span>&#125;,1,2) //&#123;name:<span class="hljs-string">'a'</span>,[1,2]&#125;<br></code></pre></td></tr></table></figure>
<h5 id="this是函数与对象的羁绊"><a href="#this是函数与对象的羁绊" class="headerlink" title="this是函数与对象的羁绊"></a>this是函数与对象的羁绊</h5><p>函数调用的时候,this只看调用时前面的对象是什么,不看定义时的对象,是独立存在的!<br>this是调用时第一个隐藏参数.<br>如<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">var name = window<br>var person = &#123;<br>    name:<span class="hljs-string">'roxas'</span>,<br>    sayHi:<span class="hljs-function"><span class="hljs-title">function</span></span>()&#123;<br>        console.log(<span class="hljs-string">'I am'</span> + this.name)<br>    &#125;<br>&#125;<br><br>person.sayHi() //I am roxas<br>//相当于perosn.sayHi.call(peroson)<br><br>var fn = person.sayHi<br>fn() //I am window<br>//相当于peroson.sayHi.call()<br></code></pre></td></tr></table></figure></p>
<h4 id="call-apply"><a href="#call-apply" class="headerlink" title="call/apply"></a>call/apply</h4><p>fn.call(_this,p1,p2)是函数的正常调用方式.<br>当你不确定参数的个数时,就使用apply.<br>fn.apply(_this,params)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">假设数组的长度不确定<br>var arr = [1,2,3,4,5,....]<br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">sum</span></span>()&#123;<br>    var n = 0;<br>    <span class="hljs-keyword">for</span>(var i = 0;i&lt; arguments.length;i++)&#123;<br>        n+= arguments[i]<br>    &#125;<br>&#125;<br><br>sum.call(undefined,arr[0],arr[1],....)<br>这时候无法用call,所以要用apply<br>sum.apply(undefined,arr)<br></code></pre></td></tr></table></figure>
<h4 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h4><p> call和appy都是直接调用函数,而bind则是返回一个新函数.<br> 但是并没有调用,这个函数调用时会call原来的函数,call的参数是bind传入的参数.<br> 也就是说,bind的函数的this是bind参入的第一个参数.</p>
<h4 id="柯里化"><a href="#柯里化" class="headerlink" title="柯里化"></a>柯里化</h4><h4 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h4><h4 id="回调"><a href="#回调" class="headerlink" title="回调"></a>回调</h4><h4 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h4><h4 id="箭头函数-1"><a href="#箭头函数-1" class="headerlink" title="箭头函数"></a>箭头函数</h4><p>与普通函数区别</p>
<ol>
<li>this是上下文的this</li>
<li>不能指定this,call()无效</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">fn</span></span>()&#123;<br>    this<br>    <span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">fn2</span></span>()&#123;<br>        this //通过调用确定<br>    &#125;<br>    var fn3 = ()=&gt;&#123;<br>        this //一定是函数内的this<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/02/20/深入了解函数/" data-id="clq63ee6m006g94fqi8cj873t" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JS/">JS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-详解Vuex的使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/16/详解Vuex的使用/" class="article-date">
  <time datetime="2019-02-16T09:22:28.000Z" itemprop="datePublished">2019-02-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/vue/">vue</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/02/16/详解Vuex的使用/">详解Vuex的使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="Vuex的引入"><a href="#Vuex的引入" class="headerlink" title="Vuex的引入"></a>Vuex的引入</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">import Vue from <span class="hljs-string">'vue'</span><br>import Vuex from <span class="hljs-string">'vuex'</span><br><br>Vue.use(Vuex)<br></code></pre></td></tr></table></figure>
<h4 id="vuex的格式"><a href="#vuex的格式" class="headerlink" title="vuex的格式"></a>vuex的格式</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">new Vuex.Store(&#123;<br>    state: &#123;<br>        //数据<br>    &#125;,<br>    getters:&#123;<br>        //可理解为state的计算属性,同计算属性一样会被缓存,刷新才重新计算<br>    &#125;<br>    mutations: &#123;<br>        //修改state的同步方法<br>    &#125;,<br>    actions: &#123;<br>        //异步方法,需要调用mutations修改state<br>    &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>
<h4 id="state的使用"><a href="#state的使用" class="headerlink" title="state的使用"></a>state的使用</h4><p>由于state是响应式的,所以在组件中使用state时,最简单的方法是用计算属性</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">//vuex<br>&#123;<br>    state:&#123;<br>        list:[1,2,3]<br>    &#125;<br>&#125;<br><br>//compoment<br><br>computed:&#123;<br>    <span class="hljs-function"><span class="hljs-title">list</span></span>()&#123;<br>        <span class="hljs-built_in">return</span> this.<span class="hljs-variable">$store</span>.state.list<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="getters的使用"><a href="#getters的使用" class="headerlink" title="getters的使用"></a>getters的使用</h4><p>可理解为state的计算属性,同计算属性一样会被缓存,刷新才重新计算<br>应用场景:当多个组件属性用到这个属性的时候,可以简化代码</p>
<h4 id="通过属性访问"><a href="#通过属性访问" class="headerlink" title="通过属性访问"></a>通过属性访问</h4><p>可以以属性的形式访问这些值<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>//vuex<br>&#123;<br>    state:&#123;<br>        list:[1,2,3]<br>    &#125;,<br>    getters:&#123;<br>        count:state=&gt;&#123;<br>            <span class="hljs-built_in">return</span> state.list.map((item)=&gt;&#123;<br>                item++<br>            &#125;)<br>        &#125;<br>    &#125;<br>&#125;<br><br>//component<br><br>computed:&#123;<br>    <span class="hljs-function"><span class="hljs-title">count</span></span>()&#123;<br>        <span class="hljs-built_in">return</span> this.<span class="hljs-variable">$store</span>.getters.count<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p>
<h5 id="通过方法访问"><a href="#通过方法访问" class="headerlink" title="通过方法访问"></a>通过方法访问</h5><p>可以通过让getter返回一个函数,来实现给getter传参,在对store数组进行查询时非常有用.<br>注意,getter通过方法访问时,每次都会进行调用,不会缓存.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>//vuex<br>getter:&#123;<br>    getNumber:(state)=&gt;&#123;<br>        (id)=&gt;&#123;<br>            <span class="hljs-built_in">return</span> state.list.find((item)=&gt;&#123;<br>                item === id<br>            &#125;)<br>        &#125;<br>    &#125;<br>&#125;<br><br>//compoment<br><br>this.<span class="hljs-variable">$store</span>.getters.getNumber(1)<br></code></pre></td></tr></table></figure>
<h5 id="mapGetters辅助函数"><a href="#mapGetters辅助函数" class="headerlink" title="mapGetters辅助函数"></a>mapGetters辅助函数</h5><p>mapGetters辅助函数仅仅是将store中的getter映射到局部计算属性</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">import &#123;mapGetters&#125; from <span class="hljs-string">'vuex'</span><br><br>computed:&#123;<br>    //使用对象展开运算符将getter混入原computed对象中<br>    ...mapGetters([<br>        <span class="hljs-string">'list1'</span>,<br>        <span class="hljs-string">'list2'</span>,<br>        <span class="hljs-string">'list3'</span>,<br>        //...<br>    ])<br>&#125;<br></code></pre></td></tr></table></figure>
<p>如想讲getter属性另取名字,使用对象形式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">mapGetters(&#123;<br>    //把this.newListname映射为this.<span class="hljs-variable">$store</span>.getters.list1<br>    newListname:<span class="hljs-string">'list1'</span><br>&#125;)<br></code></pre></td></tr></table></figure>
<h4 id="Mutation"><a href="#Mutation" class="headerlink" title="Mutation"></a>Mutation</h4><p>Mutation是vuex更改state的唯一方法,并且必须是同步的.<br>每个mutation都有一个事件类型(type)和回调函数(hander),并且以state作为第一个参数</p>
<p>调用只能通过state.commit(‘type’)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>//vuex<br>state:&#123;<br>    count:1<br>&#125;,<br>mutations:&#123;<br>    increment(state)&#123;<br>        state.count++<br>    &#125;<br>&#125;<br><br>//compoment<br><br>store.commit(<span class="hljs-string">'increment'</span>)<br></code></pre></td></tr></table></figure></p>
<h5 id="提交载荷-payload"><a href="#提交载荷-payload" class="headerlink" title="提交载荷(payload)"></a>提交载荷(payload)</h5><p>store.commit传入额外参数,即mutation的载荷(payload)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">//vuex<br><br>mutations:&#123;<br>    increment(state,n)&#123;<br>        state.count += n<br>    &#125;<br>&#125;<br><br>//component<br>store.commit(<span class="hljs-string">'increment'</span>,10)<br></code></pre></td></tr></table></figure>
<h5 id="mapMutations"><a href="#mapMutations" class="headerlink" title="mapMutations"></a>mapMutations</h5><p>同mapGetters</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs undefined">//vuex<br><br>mutations:&#123;<br>    increment(state)&#123;<br>        state.count++<br>    &#125;<br>&#125;<br><br>//compoment<br><br>improt &#123;mapMutations&#125; from &apos;vuex&apos;<br><br>methods:&#123;<br>    ..mapMutations([&apos;increment&apos;])<br>    //或<br>    //...mapMutations(&#123;<br>        add:&apos;increment&apos;<br>    &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h4><p>vuex需要异步操作时,需要用action,用action调用mutation的方法更改state</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">//vuex<br><br>state:&#123;<br>    count:0<br>&#125;,<br>mutations:&#123;<br>    increment(state)&#123;<br>        state.count++<br>    &#125;<br>&#125;.<br>actions:&#123;<br>    add(context)&#123;<br>        setTimeout(()=&gt;&#123;<br>            context.commit(<span class="hljs-string">'increment'</span>)<br>        &#125;,1000)<br>    &#125;<br>&#125;<br><br>//compoment<br>store.dispatch(<span class="hljs-string">'add'</span>)<br></code></pre></td></tr></table></figure>
<h5 id="参数context"><a href="#参数context" class="headerlink" title="参数context"></a>参数context</h5><p>action的第一个参数context相当于上下文,可以通过context.state和context.getters获取state与getters<br>可以用ES6的赋值解构进行简写.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">actions:&#123;<br>    add(&#123;commit&#125;)&#123;<br>        setTimeout(()=&gt;&#123;<br>            commit(<span class="hljs-string">'increment'</span>)<br>        &#125;,1000)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="mapActions"><a href="#mapActions" class="headerlink" title="mapActions"></a>mapActions</h5><p>方法同mapMutations</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/02/16/详解Vuex的使用/" data-id="clq63ee6w007394fqn26xujww" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/">vue</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-图片延迟加载" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/24/图片延迟加载/" class="article-date">
  <time datetime="2019-01-24T09:58:42.000Z" itemprop="datePublished">2019-01-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/业务代码/">业务代码</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/24/图片延迟加载/">图片延迟加载</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="图片延迟加载原理"><a href="#图片延迟加载原理" class="headerlink" title="图片延迟加载原理"></a>图片延迟加载原理</h4><ol>
<li>通过设置默认图片与图片属性的替换</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;img src=<span class="hljs-string">"默认图片.jpg"</span> data-src=<span class="hljs-string">"真实图片地址.jpg"</span>&gt;<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>通过监听滚动事件,判断图片是否进入视窗内<br>当图片距离视窗顶高度小于窗口高度则表示图片已进入视窗内</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">let</span> windowHeight = document.documentElement.clientHeight<br><span class="hljs-built_in">let</span> imgCurrentHeight = img.getBoundingClientRect().top<br><br><span class="hljs-keyword">if</span>(imgCurrentHeight &lt;= widnowHeight)&#123;<br>    //触发<br>&#125;<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>由于滚动时一直调用函数会造成性能损失,所以使用函数节流</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> throttle(fn,time)&#123;<br>    <span class="hljs-built_in">let</span> lastTime = 0;<br>    <span class="hljs-built_in">return</span> ()=&gt;&#123;<br>        <span class="hljs-built_in">let</span> currTime = new Date();<br>        <span class="hljs-keyword">if</span>(currTime - lastTime &gt; time|| !lastTime)&#123;<br>            fn();<br>            lastTime = 0;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">//html<br>&lt;img scr=<span class="hljs-string">"默认图片.jpg"</span> data-scr=<span class="hljs-string">"真实地址.jpg"</span>&gt;<br><br>//js<br><span class="hljs-keyword">function</span> throttle(fn,time)&#123;<br>    <span class="hljs-built_in">let</span> lastTime = 0;<br>    <span class="hljs-built_in">return</span> ()=&gt;&#123;<br>        <span class="hljs-built_in">let</span> currTime = new Date();<br>        <span class="hljs-keyword">if</span>(currTime - lastTime &gt; time|| !lastTime)&#123;<br>            fn();<br>            lastTime = 0;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">lazyLoad</span></span>()&#123;<br>    <span class="hljs-built_in">let</span> imgs = document.getElementsByTagName(<span class="hljs-string">'img'</span>)<br>    <span class="hljs-built_in">let</span> imgsLength = imgs.length<br>    <span class="hljs-built_in">let</span> n = 0; //记录每次遍历的图片,防止重新遍历<br>    <span class="hljs-built_in">return</span> ()=&gt;&#123;<br>        <span class="hljs-built_in">let</span> windowHeight = document.documentElement.clientHeight<br>        <span class="hljs-built_in">let</span> scrollHeight = document.documentElement.scrollTop<br>        <span class="hljs-keyword">for</span>(<span class="hljs-built_in">let</span> i = n;n &lt; imgsLength;i++)&#123;<br>            <span class="hljs-keyword">if</span>(imgs[i].getBoundingClientRect().top &lt; windowHeight)&#123;//当图片距离视窗顶高度小于窗口高度则表示图片已进入视窗内<br>                <span class="hljs-keyword">if</span>(imgs[i].getAttribute(<span class="hljs-string">'src'</span>) === <span class="hljs-string">'默认图片.jpg'</span> )&#123;<br>                    imgs[i].src = imgs[i].getAttribute(<span class="hljs-string">'data-src'</span>);<br>                &#125;<br>                n += 1<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br>window.addEventListener(<span class="hljs-string">'scroll'</span>,throttle(lazyLoad(),500))<br></code></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/01/24/图片延迟加载/" data-id="clq63ee61005c94fqaz0p0ebc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/业务代码/">业务代码</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-函数节流与防抖" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/24/函数节流与防抖/" class="article-date">
  <time datetime="2019-01-24T03:08:26.000Z" itemprop="datePublished">2019-01-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JS/">JS</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/24/函数节流与防抖/">函数节流与防抖</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="函数防抖-debounce"><a href="#函数防抖-debounce" class="headerlink" title="函数防抖(debounce)"></a>函数防抖(debounce)</h4><h5 id="函数防抖的定义"><a href="#函数防抖的定义" class="headerlink" title="函数防抖的定义"></a>函数防抖的定义</h5><p>事件触发,等待一段时间,假如事件在时间内不再触发,则调用函数,假如触发重新计算时间.</p>
<h5 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h5><p>设置定时器为null,假如定时器存在则清空,再设置新的定时器,事件结束后触发函数,并清空定时器.</p>
<h5 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> debounce(fn,<span class="hljs-built_in">wait</span>)&#123;<br>    <span class="hljs-built_in">let</span> timer = null;<br>    <span class="hljs-built_in">return</span> ()=&gt;&#123;<br>         <span class="hljs-keyword">if</span>(timer)&#123;<br>             clearTimeout(timer);<br>         &#125;<br>         timer = setTimeout(()=&gt;&#123;<br>             fn()<br>            timer = null<br>         &#125;,<span class="hljs-built_in">wait</span>)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h4><ol>
<li>每次resize或者scroll触发统计事件 </li>
<li>文本输入调用ajax</li>
</ol>
<h4 id="函数节流-throttle"><a href="#函数节流-throttle" class="headerlink" title="函数节流(throttle)"></a>函数节流(throttle)</h4><h5 id="函数节流的定义"><a href="#函数节流的定义" class="headerlink" title="函数节流的定义"></a>函数节流的定义</h5><p>一段时间内只能调用一次函数(技能CD)</p>
<h5 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h5><p>使用时间戳来判断是否到回调执行时间,记录上次执行时间,当当前时间与上次执行时间间隔大于时间戳则执行回调.</p>
<p>设置状态doing,触发事件,状态变为true,一段时间后变为false.只有状态为false才回调函数.</p>
<h5 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">//实现方式1<br><span class="hljs-keyword">function</span> throttle(fn,gapTime)&#123;<br>    <span class="hljs-built_in">let</span> lastTime = 0;<br>    <span class="hljs-built_in">return</span> ()=&gt;&#123;<br>        <span class="hljs-built_in">let</span> currTime = new Date();<br>        <span class="hljs-keyword">if</span>(currTime - lastTime &gt; gapTime || !lastTime)&#123;<br>            fn();<br>            lastTime = currTime<br>        &#125;<br>    &#125;<br>&#125;<br><br>//实现方式2<br><span class="hljs-keyword">function</span> throttle(fn,gapTime)&#123;<br>    <span class="hljs-built_in">let</span> doing = <span class="hljs-literal">false</span>;<br>    <span class="hljs-built_in">return</span> ()=&gt;&#123;<br>        <span class="hljs-keyword">if</span>(doing === <span class="hljs-literal">false</span>)&#123;<br>        fn()<br>        doing = <span class="hljs-literal">true</span><br>        setTimeout(()=&gt;&#123;<br>            doing = <span class="hljs-literal">false</span><br>        &#125;,gapTime)<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="应用场景-1"><a href="#应用场景-1" class="headerlink" title="应用场景"></a>应用场景</h5><ol>
<li>DOM元素拖动</li>
<li>Canvas</li>
<li>计算鼠标移动距离</li>
<li>自动联想</li>
<li>滚动到底部加载数据</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/01/24/函数节流与防抖/" data-id="clq63ee6h006294fqveq26qmn" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JS/">JS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Promise的使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/18/Promise的使用/" class="article-date">
  <time datetime="2019-01-18T13:39:10.000Z" itemprop="datePublished">2019-01-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ES6/">ES6</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/18/Promise的使用/">Promise的使用 &amp; async awit</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><h4 id="Promise-的作用"><a href="#Promise-的作用" class="headerlink" title="Promise 的作用"></a>Promise 的作用</h4><p>当一个异步函数执行的时候,需要回调,可使用 Promise 链式操作进行回调.</p>
<p>例子:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> fn1(callback)&#123;<br>    setTimeout(()=&gt;&#123;<br>        console.log(<span class="hljs-string">'fn1执行'</span>)<br>    &#125;,1000)<br>&#125;<br><br><span class="hljs-keyword">function</span> fn1(callback)&#123;<br>    setTimeout(()=&gt;&#123;<br>        console.log(<span class="hljs-string">'fn2执行'</span>)<br>        callback()<br>    &#125;,1000)<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">fn1</span></span>()&#123;<br>    setTimeout(()=&gt;&#123;<br>        console.log(<span class="hljs-string">'fn3执行'</span>)<br>        callback()<br>    &#125;,1000)<br>&#125;<br></code></pre></td></tr></table></figure>
<p>我们以前是这样回调的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs undefined"><br>fn1(()=&gt;&#123;<br>    fn2(()=&gt;&#123;<br>        fn3<br>    &#125;)<br>&#125;)<br>//控制台一秒后输出 fn1,再一秒后输出 fn2,再一秒后输出 fn3<br></code></pre></td></tr></table></figure>
<p>因为回调函数复杂的时候非常麻烦,所以我们可以使用 promise 改写上面的函数</p>
<h4 id="Promise-语法"><a href="#Promise-语法" class="headerlink" title="Promise 语法"></a>Promise 语法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">promiseFn</span></span>()&#123;<br>    <span class="hljs-built_in">return</span> new Promise((resolve,reject)=&gt;&#123;<br>        //当异步函数执行成功时<br>        resolve();<br>        //当异步函数执行失败时,<br>        reject();<br>    &#125;)<br>&#125;<br><br>promiseFn().<span class="hljs-keyword">then</span>(()=&gt;&#123;&#125;).catch(()=&gt;&#123;&#125;)<br></code></pre></td></tr></table></figure>
<p>构造函数 Promise 接收一个参数 function,function 接收两个参数,一个是成功时执行的函数,一个是失败时执行的函数.<br>通过链式操作,我们可以分别对不同的结果分别执行不同的回调函数.</p>
<p>通过 promise 改写上面的函数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">fn1</span></span>()&#123;<br>    <span class="hljs-built_in">return</span> new Promise((resolve, reject) =&gt; &#123;<br>        setTimeout(() =&gt; &#123;<br>            console.log(<span class="hljs-string">'fn1执行'</span>)<br>            resolve()<br>        &#125;, 1000)<br>    &#125;)<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">fn2</span></span>()&#123;<br>    <span class="hljs-built_in">return</span> new Promise((resolve, reject) =&gt; &#123;<br>        setTimeout(() =&gt; &#123;<br>            console.log(<span class="hljs-string">'fn2执行'</span>)<br>            resolve()<br>        &#125;, 1000)<br>    &#125;)<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">fn3</span></span>()&#123;<br>    <span class="hljs-built_in">return</span> new Promise((resolve, reject) =&gt; &#123;<br>        setTimeout(() =&gt; &#123;<br>            console.log(<span class="hljs-string">'fn3执行'</span>)<br>            resolve()<br>        &#125;, 1000)<br>    &#125;)<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">onerror</span></span>() &#123;<br>    console.log(<span class="hljs-string">'error'</span>)<br>&#125;<br><br>fn1().<span class="hljs-keyword">then</span>(fn2).<span class="hljs-keyword">then</span>(fn3).catch(onerror)<br></code></pre></td></tr></table></figure>
<p>当异步函数执行时,下一个异步函数需要用上一个异步函数的返回值可以这样写</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash">//定义函数获取城市<br><span class="hljs-keyword">function</span> getCity(ip)&#123;<br>    <span class="hljs-built_in">return</span> new Promise((resolve,reject)=&gt;&#123;<br>        <span class="hljs-built_in">let</span> xhr = new XMLHttpRequest();<br>        xhr.open(<span class="hljs-string">'GET'</span>,url/ip,<span class="hljs-literal">true</span>)<br>        xhr.onload = <span class="hljs-function"><span class="hljs-title">function</span></span>()&#123;<br>            var data = JSON.parse(xhr.responseText) //获得数据<br>            resolve(data)<br>        &#125;<br>        xhr.onerror = <span class="hljs-function"><span class="hljs-title">function</span></span>()&#123;<br>            reject(<span class="hljs-string">'获取失败'</span>)<br>        &#125;<br>        xhr.send()<br>    &#125;)<br>&#125;<br>//定义函数获取天气<br><span class="hljs-keyword">function</span> getWeather(city)&#123;<br>    <span class="hljs-built_in">return</span> new Promise((resolve,reject)=&gt;&#123;<br>        <span class="hljs-built_in">let</span> xhr = new XMLHttpRequest();<br>        xhr.open(<span class="hljs-string">'GET'</span>,url/city,<span class="hljs-literal">true</span>)<br>        xhr.onload = <span class="hljs-function"><span class="hljs-title">function</span></span>()&#123;<br>            var data = JSON.parse(xhr.responseText)<br>        &#125;<br>        xhr.onerror = <span class="hljs-function"><span class="hljs-title">function</span></span>()&#123;<br>            reject(<span class="hljs-string">'获取失败'</span>)<br>        &#125;<br>        xhr.send<br>    &#125;)<br>&#125;<br><br>//调用<br><br>getCity(上海).<span class="hljs-keyword">then</span>((city)=&gt;&#123;<br>    <span class="hljs-built_in">return</span> getWeather(city)<br>&#125;).<span class="hljs-keyword">then</span>((res)=&gt;&#123;<br>    console.log(res)<br>&#125;).catch((error)=&gt;&#123;<br>    console.log(error)<br>&#125;)<br></code></pre></td></tr></table></figure>
<h4 id="Promise-all"><a href="#Promise-all" class="headerlink" title="Promise.all"></a>Promise.all</h4><p>当有几个 promise 的时候,我们可以用 promise.all 让所有 promise 状态变更之后再回调</p>
<p>then 的第一个参数是所有成功才执行,第二个参数是只要有一个失败就执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Promise.all([p1,p2,p3]).<span class="hljs-keyword">then</span>((res1,res2,res3)=&gt;&#123;&#125;,(res1,res2,res3)=&gt;&#123;&#125;)<br></code></pre></td></tr></table></figure>
<h4 id="Promise-race"><a href="#Promise-race" class="headerlink" title="Promise.race"></a>Promise.race</h4><p>当有几个 promise 的时候,我们可以用 promise.race 来获取最快/成功 promise 的 resolve</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Promise.race([p1,p2,p3]).<span class="hljs-keyword">then</span>(()=&gt;&#123;&#125;)<br></code></pre></td></tr></table></figure>
<h4 id="Promise-reject"><a href="#Promise-reject" class="headerlink" title="Promise.reject()"></a>Promise.reject()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs undefined">Promise.reject(&quot;Testing static reject&quot;).then((reason)=&gt;&#123;<br>  // 未被调用<br>&#125;, (reason) =&gt; &#123;<br>  console.log(reason); // &quot;Testing static reject&quot;<br>&#125;);<br><br>Promise.reject(new Error(&quot;fail&quot;)).then((result)=&gt;&#123;<br>  // 未被调用<br>&#125;, (error)=&gt;&#123;<br>  console.log(error); // stacktrace<br>&#125;);<br></code></pre></td></tr></table></figure>
<h4 id="finally"><a href="#finally" class="headerlink" title="finally"></a>finally</h4><p>当 promise 状态变更的时候时候,不管成功与失败,我们都可以执行同一个方法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">.finally(loading=&gt;&#123;<br>    loding = <span class="hljs-literal">false</span><br>&#125;)<br><br>等价于<br>.<span class="hljs-keyword">then</span>(loading=&gt;&#123;loading = fasle&#125;,loading=&gt;&#123;loading = fasle&#125;)<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">promiseFn().finaly(&#123;&#125;=&gt;&#123;<br>    console.log(<span class="hljs-string">'异步结束'</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>
<h4 id="catch"><a href="#catch" class="headerlink" title="catch"></a>catch</h4><p>只处理错误</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">.catch(error=&gt;&#123;<br>    console.log(error)<br>&#125;)<br><br>等价于<br><br>.<span class="hljs-keyword">then</span>(null,(error)=&gt;&#123;<br>    console.log(error)<br>&#125;)<br></code></pre></td></tr></table></figure>
<h3 id="async-await"><a href="#async-await" class="headerlink" title="async await"></a>async await</h3><h4 id="await"><a href="#await" class="headerlink" title="await"></a>await</h4><p>等待 promise 结束,并返回 resolve 的值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> isDog(name)&#123;<br>    <span class="hljs-built_in">return</span> new Promise((resove,reject)=&gt;&#123;<br>        setTimeout(()=&gt;&#123;<br>           <span class="hljs-keyword">if</span>(name === <span class="hljs-string">'dog'</span>)&#123;<br>               resove(<span class="hljs-string">'yes'</span>)<br>           &#125;<span class="hljs-keyword">else</span>&#123;<br>               reject(<span class="hljs-string">'no'</span>)<br>           &#125;<br>        &#125;,1000)<br>    &#125;)<br>&#125;<br><br> <span class="hljs-built_in">let</span> isWhat = await isDog(<span class="hljs-string">'dog'</span>) //<span class="hljs-string">'yes'</span><br></code></pre></td></tr></table></figure>
<h4 id="async"><a href="#async" class="headerlink" title="async"></a>async</h4><p>所有 async 函数都会隐式返回 promise 对象</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">async <span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">test</span></span>()&#123;<br>    <span class="hljs-built_in">let</span> isWhat = await isDog(<span class="hljs-string">'dog'</span>)<br>    console.log(isWhat) //yes<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="使用-async-函数-使用-try-catch-获取-promise-结果"><a href="#使用-async-函数-使用-try-catch-获取-promise-结果" class="headerlink" title="使用 async 函数,使用 try catch 获取 promise 结果"></a>使用 async 函数,使用 try catch 获取 promise 结果</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> isDog(name)&#123;<br>    <span class="hljs-built_in">return</span> new Promise((resove,reject)=&gt;&#123;<br>        setTimeout(()=&gt;&#123;<br>           <span class="hljs-keyword">if</span>(name === <span class="hljs-string">'dog'</span>)&#123;<br>               resove(<span class="hljs-string">'yes'</span>)<br>           &#125;<span class="hljs-keyword">else</span>&#123;<br>               reject(<span class="hljs-string">'no'</span>)<br>           &#125;<br>        &#125;,1000)<br>    &#125;)<br>&#125;<br><br>async <span class="hljs-keyword">function</span> <span class="hljs-built_in">test</span>(name)&#123;<br>    try&#123;<br>        <span class="hljs-built_in">let</span> isWhat = await isDog(name)<br>        console.log(isWhat)<br>    &#125;catch(error)&#123;<br>        console.log(error)<br>    &#125;<br><br>&#125;<br><br><span class="hljs-built_in">test</span>(<span class="hljs-string">'dog'</span>) //yes<br><span class="hljs-built_in">test</span>(<span class="hljs-string">'cat'</span>) //no<br></code></pre></td></tr></table></figure>
<h5 id="使用-async-函数获取两以个-promise-结果"><a href="#使用-async-函数获取两以个-promise-结果" class="headerlink" title="使用 async 函数获取两以个 promise 结果"></a>使用 async 函数获取两以个 promise 结果</h5><p>只有当两个 promise 都成功时,await 才会赋值,否则进入 catch</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> isDog(name)&#123;<br>    <span class="hljs-built_in">return</span> new Promise((resove,reject)=&gt;&#123;<br>        setTimeout(()=&gt;&#123;<br>           <span class="hljs-keyword">if</span>(name === <span class="hljs-string">'dog'</span>)&#123;<br>               resove(<span class="hljs-string">'yes'</span>)<br>           &#125;<span class="hljs-keyword">else</span>&#123;<br>               reject(<span class="hljs-string">'no'</span>)<br>           &#125;<br>        &#125;,1000)<br>    &#125;)<br>&#125;<br><br>async <span class="hljs-keyword">function</span> <span class="hljs-built_in">test</span>(name1,name2)&#123;<br>    try&#123;<br>        <span class="hljs-built_in">let</span> isWhat = await Promise.all([isDog(name1),isDog(name2)])<br>        console.log(isWhat)<br>    &#125;catch(error)&#123;<br>        console.log(error)<br>    &#125;<br><br>&#125;<br><br><span class="hljs-built_in">test</span>(<span class="hljs-string">'dog'</span>,<span class="hljs-string">'dog'</span>) //[yes,yes]<br><span class="hljs-built_in">test</span>(<span class="hljs-string">'dog'</span>,<span class="hljs-string">'cat'</span>) //no<br><span class="hljs-built_in">test</span>(<span class="hljs-string">'cat'</span>,<span class="hljs-string">'cat'</span>) //no<br></code></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/01/18/Promise的使用/" data-id="clq63ee4e001y94fqklu4dp7u" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ES6/">ES6</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-密码强度" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/11/密码强度/" class="article-date">
  <time datetime="2019-01-11T05:12:52.000Z" itemprop="datePublished">2019-01-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/业务代码/">业务代码</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/11/密码强度/">密码强度的实现</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="密码强度"><a href="#密码强度" class="headerlink" title="密码强度"></a>密码强度</h3><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><h5 id="使用字符串-函数与运算符"><a href="#使用字符串-函数与运算符" class="headerlink" title="使用字符串,函数与运算符."></a>使用字符串,函数与运算符.</h5><p>一般密码会有数字,字母(大小写),特殊符号四种类型.</p>
<p>1:密码中只包含一种类型;<br>2:密码中包含两种类型;<br>3:密码中包含三种类型;<br>4:密码中包含所以类型.</p>
<h5 id="用以下形式表示四种字符的类型"><a href="#用以下形式表示四种字符的类型" class="headerlink" title="用以下形式表示四种字符的类型."></a>用以下形式表示四种字符的类型.</h5><table>
<thead>
<tr>
<th>字符类型</th>
<th style="text-align:center">二进制数字</th>
<th style="text-align:left">ASCII</th>
</tr>
</thead>
<tbody>
<tr>
<td>数字</td>
<td style="text-align:center">0001</td>
<td style="text-align:left">48~57</td>
</tr>
<tr>
<td>小写字母</td>
<td style="text-align:center">0010</td>
<td style="text-align:left">97~122</td>
</tr>
<tr>
<td>大写字母</td>
<td style="text-align:center">0100</td>
<td style="text-align:left">65~90</td>
</tr>
<tr>
<td>特殊字符</td>
<td style="text-align:center">1000</td>
<td style="text-align:left">ohter</td>
</tr>
</tbody>
</table>
<h5 id="例子"><a href="#例子" class="headerlink" title="例子:"></a>例子:</h5><table>
<thead>
<tr>
<th>字符类型</th>
<th style="text-align:center">二进制数字</th>
<th style="text-align:left">十进制</th>
</tr>
</thead>
<tbody>
<tr>
<td>1234</td>
<td style="text-align:center">0001/0001/0001/0001</td>
<td style="text-align:left">0001-&gt;1</td>
</tr>
<tr>
<td>abcd</td>
<td style="text-align:center">0010/0010/0010/0010</td>
<td style="text-align:left">0010-&gt;2</td>
</tr>
<tr>
<td>ABCD</td>
<td style="text-align:center">0100/0100/0100/0100</td>
<td style="text-align:left">0100-&gt;4</td>
</tr>
<tr>
<td>!@#$</td>
<td style="text-align:center">1000/1000/1000/1000</td>
<td style="text-align:left">1000-&gt;8</td>
</tr>
<tr>
<td>Aa1!</td>
<td style="text-align:center">0100/0010/0001/1000</td>
<td style="text-align:left">1111-&gt;15</td>
</tr>
</tbody>
</table>
<p>即:把密码变成4位二进制数,1的个数越多,密码强度越大.</p>
<h5 id="把二进数转换为强度"><a href="#把二进数转换为强度" class="headerlink" title="把二进数转换为强度"></a>把二进数转换为强度</h5><p>每次与1做”位于”(&amp;1)运算,假如为真,则强度+1(level++),否则不变,每循环一次,位移(&gt;&gt;&gt;)操作一次.</p>
<p>如:Abcd1234!:1111</p>
<ol>
<li>1111 &amp; 1;level=1;右移一位,得0111;</li>
<li>0111 &amp; 1;level=2;右移一位,得0011;</li>
<li>0011 &amp; 1;level=3;右移一位,得0001;</li>
<li>0001 &amp; 1;level=4;</li>
</ol>
<p>所以密码强度为4.</p>
<h5 id="使用jQuery实现代码"><a href="#使用jQuery实现代码" class="headerlink" title="使用jQuery实现代码"></a>使用jQuery实现代码</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&lt;script&gt;<br>    var $password = $(&apos;#password&apos;);<br>    var $span = $(&apos;span&apos;);<br>    $password.on(&apos;keyup&apos;,()=&gt;&#123;<br>        let password = $password.val();<br>        checkLevel(password);<br>    &#125;)<br>    function Chartype(num)&#123;//检测字符串类型<br>        if(num &gt;= 48 &amp;&amp; num &lt;= 57)&#123;//数字<br>            return 1;<br>        &#125;else if(num &gt;= 97 &amp;&amp; num &lt;= 122)&#123;//小写字母<br>            return 2;<br>        &#125;else if(num &gt;= 65 &amp;&amp; num &lt;= 90)&#123;//大写字母<br>            return 4;<br>        &#125;else&#123;//符号<br>            return 8;<br>        &#125;<br>    &#125;<br>    function checkLevel(str)&#123;//检测密码强度<br>        let check = 0;<br>        let level = 0;<br>        for(let i = 0;i&lt;str.length;i++)&#123;<br>            check |= Chartype(str.charCodeAt(i));<br>        &#125;<br>        for(var i = 0;i &lt;= 4;i++)&#123;<br>            if(check &amp; 1)&#123;//每次循环位于运算<br>                level++;<br>            &#125;<br>            check = check &gt;&gt;&gt; 1;//运算结束后右移一位<br>        &#125;<br>        if(str.length &gt;= 8)&#123;//当密码大于8执行<br>            selectLevel(level);<br>        &#125;else&#123;//小于8清空<br>            level = 0;<br>            $span.removeClass(&apos;active&apos;);<br>        &#125;<br>        <br>    &#125;<br>    function selectLevel(level)&#123;//根据密码强度切换类<br>            switch(level)&#123;<br>                case 1:<br>                    $span.removeClass(&apos;active&apos;);<br>                    $(&apos;.first&apos;).addClass(&apos;active&apos;);<br>                    break;<br>                case 2:<br>                    $span.removeClass(&apos;active&apos;);<br>                    $(&apos;.second&apos;).addClass(&apos;active&apos;);<br>                    break;<br>                case 3:<br>                    $span.removeClass(&apos;active&apos;);<br>                    $(&apos;.thrid&apos;).addClass(&apos;active&apos;);<br>                    break;  <br>                case 4:<br>                    $span.removeClass(&apos;active&apos;);<br>                    $(&apos;.fourth&apos;).addClass(&apos;active&apos;);<br>                    break;  <br>            &#125;<br>    &#125;<br><br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/01/11/密码强度/" data-id="clq63ee65005i94fqslf9uh9q" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/业务代码/">业务代码</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-CSS盒子多边框" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/04/CSS盒子多边框/" class="article-date">
  <time datetime="2018-09-04T15:40:45.000Z" itemprop="datePublished">2018-09-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/04/CSS盒子多边框/">CSS盒子多边框</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/09/04/CSS盒子多边框/" data-id="clq63ee2o000694fqxslzltq4" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/5/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CSS/">CSS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ES6/">ES6</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTML/">HTML</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTTP/">HTTP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JS/">JS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/TS/">TS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node/">node</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/">vue</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/webpack/">webpack</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/业务代码/">业务代码</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/库/">库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/笔记/">笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机基础/">计算机基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/面试题/">面试题</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6/">ES6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JS/">JS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TS/">TS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/">webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/业务代码/">业务代码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/库/">库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/笔记/">笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/计算机基础/">计算机基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面试/">面试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面试题/">面试题</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CSS/" style="font-size: 18.75px;">CSS</a> <a href="/tags/ES6/" style="font-size: 16.25px;">ES6</a> <a href="/tags/HTML/" style="font-size: 10px;">HTML</a> <a href="/tags/HTTP/" style="font-size: 15px;">HTTP</a> <a href="/tags/JS/" style="font-size: 20px;">JS</a> <a href="/tags/TS/" style="font-size: 17.5px;">TS</a> <a href="/tags/git/" style="font-size: 11.25px;">git</a> <a href="/tags/node/" style="font-size: 10px;">node</a> <a href="/tags/vue/" style="font-size: 18.75px;">vue</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a> <a href="/tags/业务代码/" style="font-size: 13.75px;">业务代码</a> <a href="/tags/库/" style="font-size: 12.5px;">库</a> <a href="/tags/笔记/" style="font-size: 10px;">笔记</a> <a href="/tags/计算机基础/" style="font-size: 10px;">计算机基础</a> <a href="/tags/面试/" style="font-size: 10px;">面试</a> <a href="/tags/面试题/" style="font-size: 10px;">面试题</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">十二月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">二月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/12/15/test/">test</a>
          </li>
        
          <li>
            <a href="/2023/02/02/手写Promise-all/">手写Promise.all</a>
          </li>
        
          <li>
            <a href="/2023/02/02/Canvas和SVG区别/">Canvas和SVG区别</a>
          </li>
        
          <li>
            <a href="/2020/02/12/常见排序算法/">常见排序算法</a>
          </li>
        
          <li>
            <a href="/2020/01/17/TS声明/">TS声明</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2023 Roxas Deng<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>