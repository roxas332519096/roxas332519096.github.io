<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><meta name="theme-color" content="#2d4356"><meta name="baidu-site-verification"><title>AJAX | RoxasDengBlog</title><link rel="stylesheet" type="text/css" href="/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.png"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script></head><link rel="stylesheet" type="text/css" href="/plugins/highlight/atom-one-dark.min.css"><script type="text/javascript" src="/plugins/highlight/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();
</script><script type="text/javascript" src="/js/ready.js" async></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><body class="night"><div class="mobile-head" id="mobile-head"><div class="navbar-icon"><span></span><span></span><span></span></div><div class="navbar-title"><a href="/">LITREILY</a></div><div class="navbar-search"><!--= show a circle here--></div></div><div class="h-wrapper" id="menu"><nav class="h-head box"><div class="m-hdimg"><a class="hdimg img" href="/"><img class="nofancybox" src="/img/profile.jpg" width="128" height="128"></a><h1 class="ttl"><a href="/">RoxasDengBlog</a></h1></div><p class="m-desc">心之所向，无惧无悔,<br>愿求仁得仁，复无怨怼！</p><div class="m-nav"><ul><li><span class="dot">●</span><a href="/archives/">归档</a></li><li><span class="dot">●</span><a href="/categories/">分类</a></li><li><span class="dot">●</span><a href="/tags/">标签</a></li><li><span class="dot">●</span><a href="/about/">关于</a></li><li><span class="dot">●</span><a href="/atom.xml">RSS</a></li><li class="m-sch"><form class="form" id="j-formsch" method="get"><input class="txt" type="text" id="local-search-input" name="q" value="搜索" onfocus="if(this.value=='搜索'){this.value='';}" onblur="if(this.value==''){this.value='搜索';}"><input type="text" style="display:none;"></form></li></ul><div id="local-search-result"></div></div></nav></div><div id="back2Top"><a class="fa fa-arrow-up" title="Back to top" href="#"></a></div><div class="box" id="container"><div class="l-wrapper"><div class="l-content box"><div class="l-post l-post-art"><article class="p-art"><div class="p-header box"><h1 class="p-title">AJAX</h1><div class="p-info"><span class="p-date"><i class="fa fa-calendar"></i><a href="/2018/05/31/AJAX/">2018-05-31</a></span><span class="p-category"><i class="fa fa-folder"></i><a href="/categories/JS/">JS</a></span><span class="p-view" id="busuanzi_container_page_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_page_pv"></span></span></div></div><div class="p-content"><h4 id="AJAX是什么"><a href="#AJAX是什么" class="headerlink" title="AJAX是什么?"></a>AJAX是什么?</h4><p>异步的JavaScript和XML</p>
<ol>
<li>使用XMLHttpRequest发送请求</li>
<li>服务器返回XML格式的字符串</li>
<li>JS解析XML,并更新局部页面</li>
</ol>
<h5 id="现在已经很少用XML-都在用JSON"><a href="#现在已经很少用XML-都在用JSON" class="headerlink" title="现在已经很少用XML,都在用JSON!"></a>现在已经很少用XML,都在用JSON!</h5><h4 id="写一个简单的AJAX"><a href="#写一个简单的AJAX" class="headerlink" title="写一个简单的AJAX:"></a>写一个简单的AJAX:</h4><pre><code class="bash">let request = new XMLHttpRequest();
request.open(&#39;GET&#39;,&#39;http://localhost:8001&#39;);
request.onreadystatechange = () =&gt; {
    if(request.readyState ===4){
        console.log(&#39;响应完毕&#39;);
        if(request.status =&gt; 200 &amp;&amp; request.status &lt; 300 || request.status === 304){
            console.log(&#39;请求成功&#39;);
            let string  = request.responseText;
            let objcet  = window.JSON.parse(string);
        }
    }else if(request.status &gt;= 400){
        console.log(&#39;请求失败&#39;)
    }
}
request.send();
</code></pre>
<h4 id="readyState-请求状态"><a href="#readyState-请求状态" class="headerlink" title="readyState 请求状态"></a>readyState 请求状态</h4><p>有五种状态:</p>
<p>0 open()方法还未被调用.<br>1 send()方法还未被调用.<br>2 send()方法已被调用,响应头和响应状态已经返回.<br>3 响应体下载中;responseText中已获取了部分数据.<br>4 整个请求过程已经完毕.</p>
<h4 id="request-status-返回请求的状态码"><a href="#request-status-返回请求的状态码" class="headerlink" title="request.status 返回请求的状态码"></a>request.status 返回请求的状态码</h4><h4 id="request-responseText-返回的字符串"><a href="#request-responseText-返回的字符串" class="headerlink" title="request.responseText 返回的字符串"></a>request.responseText 返回的字符串</h4><h4 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h4><h5 id="JS-VS-JSON"><a href="#JS-VS-JSON" class="headerlink" title="JS VS JSON"></a>JS VS JSON</h5><ol>
<li>JSON 没有undefined和funtion</li>
<li>JSON 字符串的首尾必须是双引号””</li>
</ol>
<p>具体对比</p>
<p>undefined      没有<br>null           null<br>[‘a’,’b’]      [“a”,”b”]<br>function(){}   没有<br>{name:’roxas’} {“name”:”roxas”}<br>‘roxas’        “roxas”<br>var a = {}<br>a.self  = a    搞不定(没有变量)<br>{<strong>proto</strong>}    没有原型链</p>
<h4 id="JS使用JSON"><a href="#JS使用JSON" class="headerlink" title="JS使用JSON"></a>JS使用JSON</h4><p>一个JSON对象</p>
<pre><code class="bash">{
    &quot;notes&quot;:{
        &quot;from&quot;:&quot;roxas&quot;,
        &quot;to&quot;:&quot;养蛇&quot;,
        &quot;title&quot;:&quot;打招呼&quot;,
        &quot;contant&quot;:&quot;你好&quot;
    }
}
</code></pre>
<p>JS代码使用JSON</p>
<pre><code class="bash">let request = new XMLHttprequest();
request.open(&#39;GET&#39;,&#39;URL&#39;)  //配置request
request.onreadystatechange = ()=&gt;{
    if(request.readyState === 4) {
        if(request.status &gt;= 200 &amp;&amp; request.status &lt;300 || request.status === 304){
            let string = request.responseText;
            // 把符合 JSON 语法的字符串转换成JS对应的值
            let object = window.JSON.parse(string);
            console.log(object);
        }esle if(request.status &gt;= 400){
            console.log(&#39;说明请求失败&#39;);
        }
    }
}
request.send();
</code></pre>
<p>后端代码</p>
<pre><code class="bash">else if(path===&#39;url&#39;){
    response.statusCode = 200
    response.setHeader(&#39;Content-Type&#39;, &#39;text/json;charset=utf-8&#39;)
    response.setHeader(&#39;Access-Control-Allow-Origin&#39;, &#39;http://localhsot:8001&#39;)
    response.write(`
    {
    &quot;notes&quot;:{
        &quot;from&quot;:&quot;roxas&quot;,
        &quot;to&quot;:&quot;养蛇&quot;,
        &quot;title&quot;:&quot;打招呼&quot;,
        &quot;contant&quot;:&quot;你好&quot;
        }
    }
    `)
    response.end()
</code></pre>
<h4 id="同源策略"><a href="#同源策略" class="headerlink" title="同源策略"></a>同源策略</h4><h5 id="只有-协议-端口-域名-一模一样才允许发-AJAX-请求"><a href="#只有-协议-端口-域名-一模一样才允许发-AJAX-请求" class="headerlink" title="只有 协议+端口+域名 一模一样才允许发 AJAX 请求"></a>只有 协议+端口+域名 一模一样才允许发 AJAX 请求</h5><p>例:<br><a href="http://baidu.com" target="_blank" rel="noopener">http://baidu.com</a> 可以向 <a href="http://www.baidu.com" target="_blank" rel="noopener">http://www.baidu.com</a> 发 AJAX 请求吗 no<br><a href="http://baidu.com:80" target="_blank" rel="noopener">http://baidu.com:80</a> 可以向 <a href="http://baidu.com:81" target="_blank" rel="noopener">http://baidu.com:81</a> 发 AJAX 请求吗 no</p>
<p>CORS可以告诉浏览器,我俩一家的，别阻止他</p>
<h5 id="CORS-Cross-Origin-Resource-Sharing-跨源资源共享"><a href="#CORS-Cross-Origin-Resource-Sharing-跨源资源共享" class="headerlink" title="CORS:Cross-Origin Resource Sharing(跨源资源共享)"></a>CORS:Cross-Origin Resource Sharing(跨源资源共享)</h5><p>响应的服务器(8001)代码加入响应头:</p>
<pre><code class="bash">response.setHeader(&#39;Access-Control-Allow-Origin&#39;, &#39;http://localhsot:8002&#39;)
</code></pre>
<p>AJXA获取请求与响应的所有信息</p>
<h4 id="请求"><a href="#请求" class="headerlink" title="请求:"></a>请求:</h4><pre><code class="bash">POST / HTTP/1.1
HOST: localhost:8001
Content-Type:application/x-www-url-encoded

a=1&amp;b=2
</code></pre>
<p>第一部分: </p>
<pre><code class="bash">request.open(&#39;POST&#39;,&#39;http://localhost:8001&#39;)
</code></pre>
<p>第二部分:</p>
<pre><code class="bash">request.setHeader(&#39;Content-Type&#39;,&#39;x-www-form-urlencoded&#39;)
</code></pre>
<p>第四部分:</p>
<pre><code class="bash">request.send(&#39;a=1&amp;b=2&#39;)
</code></pre>
<h5 id="响应"><a href="#响应" class="headerlink" title="响应:"></a>响应:</h5><pre><code class="bash">HTTP/1.1 200 OK
Content-Type: text/html

&lt;!DOCTYPE html&gt;
&lt;html&gt;...&lt;/html&gt;
</code></pre>
<p>第一部分:</p>
<pre><code class="bash">request.status //200
request.statusText //OK
</code></pre>
<p>第二部分:</p>
<pre><code class="bash">request.getResponseHeader() //获得值
或
request.getResponseHeaders() //获得hash
</code></pre>
<p>第四部分:</p>
<pre><code class="bash">request.responseText
</code></pre>
<h4 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h4><p>函数用参数是一个函数,参数名字为callback</p>
<p>call a function<br>call a function  back</p>
<p>callback</p>
<p>callback  === function</p>
<h4 id="ES6语法-解构赋值"><a href="#ES6语法-解构赋值" class="headerlink" title="ES6语法 解构赋值"></a>ES6语法 解构赋值</h4><p>ES5</p>
<pre><code class="bash">let method = options.method;
let body = options.body;
let successFn = options.successFn;
let failFn = options.failFn;
let headers = options.headers;
</code></pre>
<p>ES6</p>
<pre><code class="bash">let {method,body,successFn,failFn,headers} = option
</code></pre>
<h4 id="封装jQuery-ajax"><a href="#封装jQuery-ajax" class="headerlink" title="封装jQuery.ajax"></a>封装jQuery.ajax</h4><pre><code class="bash">// 选择器,不用看
var jQuery = function(nodeOrSelector){
    let nodes = {}
    if(typeof nodeOrSelector === &#39;string&#39;){
        let temp = document.querySelectorAll(nodeOrSelector);
        for(let i = 0;i&lt;temp.length;i++){
            nodes[i] = temp[i]
        }
        nodes.length = temp.length;
    }else if(nodeOrSelector instanceof Node){
        nodes = {
            0:nodeOrSelector,
            length:1
        }
    }
    return {
        addClass:function(){},
        setText:function(){}
    }
}
window.jQuery = jQuery;
window.$ = jQuery;
//以下为ajxa代码

window.jQuery.ajax = function({url,method,body,headers}){
    return new Promise(function(resolve,reject){
        let request = new XMLHttprequest();
        request.open(method,url);
        for(let key in headers){
            let value = headers[key];
            request.setRequestHeader(key,value)
        }
        request.onreadystatechange = ()=&gt;{
            if(request.readystates === 4){
                if(request.status &gt;= 200 &amp;&amp; request.status &lt; 300){
                    resolve.call(undefined,request.responseText);
                }else if(request.status &gt;= 400){
                    reject.call(undefined,request)
                }
            }
        }
        request.send(body);
    })
}
</code></pre>
<h4 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h4><p>return new Promise (function(resolve,reject){})</p>
<pre><code class="bash">function xxx(){
    return new Promise((f1,f2)=&gt;{
        doSometing();
        setTimeout(()=&gt;{
            //成功就调用f1,失败就调用f2
        },3000)
    })
}

xxx().then(success,fail);
//链式操作

xxx().then(success,fail).then(success,fail);
</code></pre>
</div><div class="p-copyright"><blockquote><div class="p-copyright-author"><span class="p-copyright-key">本文作者：</span><span class="p-copytight-value"><a href="mailto:litreily@163.com">Roxas Deng</a></span></div><div class="p-copyright-link"><span class="p-copyright-key">本文链接：</span><span class="p-copytight-value"><a href="/2018/05/31/AJAX/">http://yoursite.com/2018/05/31/AJAX/</a></span></div><div class="p-copyright-note"><span class="p-copyright-key">版权声明：</span><span class="p-copytight-value">本博客所有文章除特殊声明外，均采用<a rel="nofollow" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/"> CC BY-NC 4.0 </a>许可协议。转载请注明出处 <a href="http://yoursite.com">Roxas Deng的博客</a>！</span></div></blockquote></div></article><div class="p-info box"><span class="p-tags"><i class="fa fa-tag"></i><a href="/tags/JS/">JS</a></span></div><aside id="toc"><div class="toc-title">目录</div><nav><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#AJAX是什么"><span class="toc-number">1.</span> <span class="toc-text">AJAX是什么?</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#现在已经很少用XML-都在用JSON"><span class="toc-number">1.1.</span> <span class="toc-text">现在已经很少用XML,都在用JSON!</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#写一个简单的AJAX"><span class="toc-number">2.</span> <span class="toc-text">写一个简单的AJAX:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#readyState-请求状态"><span class="toc-number">3.</span> <span class="toc-text">readyState 请求状态</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#request-status-返回请求的状态码"><span class="toc-number">4.</span> <span class="toc-text">request.status 返回请求的状态码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#request-responseText-返回的字符串"><span class="toc-number">5.</span> <span class="toc-text">request.responseText 返回的字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JSON"><span class="toc-number">6.</span> <span class="toc-text">JSON</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#JS-VS-JSON"><span class="toc-number">6.1.</span> <span class="toc-text">JS VS JSON</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JS使用JSON"><span class="toc-number">7.</span> <span class="toc-text">JS使用JSON</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#同源策略"><span class="toc-number">8.</span> <span class="toc-text">同源策略</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#只有-协议-端口-域名-一模一样才允许发-AJAX-请求"><span class="toc-number">8.1.</span> <span class="toc-text">只有 协议+端口+域名 一模一样才允许发 AJAX 请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CORS-Cross-Origin-Resource-Sharing-跨源资源共享"><span class="toc-number">8.2.</span> <span class="toc-text">CORS:Cross-Origin Resource Sharing(跨源资源共享)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#请求"><span class="toc-number">9.</span> <span class="toc-text">请求:</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#响应"><span class="toc-number">9.1.</span> <span class="toc-text">响应:</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#回调函数"><span class="toc-number">10.</span> <span class="toc-text">回调函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ES6语法-解构赋值"><span class="toc-number">11.</span> <span class="toc-text">ES6语法 解构赋值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#封装jQuery-ajax"><span class="toc-number">12.</span> <span class="toc-text">封装jQuery.ajax</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Promise"><span class="toc-number">13.</span> <span class="toc-text">Promise</span></a></li></ol></nav></aside></div><section class="p-ext"><div class="l-pager l-pager-dtl box"><a class="prev" href="/2018/06/04/从一个页面输入URL到页面显示完成-这个过程中都发生了什么/">&lt; 从一个页面输入URL到页面显示完成,这个过程中都发生了什么?</a><a class="next" href="/2018/05/30/JSONP/">JSONP &gt;</a></div></section><footer><p>Copyright © 2016 - 2023 <a href="/." rel="nofollow">RoxasDengBlog</a> | <strong><a rel="nofollow" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></strong><br><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span></span> <span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span></span> | Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a>Theme with<a rel="nofollow" target="_blank" href="https://github.com/litreily/snark-hexo"> snark.</a></p></footer></div></div></div><script type="text/javascript" src="/js/search.js"></script><script type="text/javascript" src="/js/top.js"></script><script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
    search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script></body></html>